{"version":3,"sources":["webpack:///webpack/bootstrap 48c883a087923475c728?8083","webpack:///./index.js?2645","webpack:///./RogueGame.js?9b46","webpack:///./GridWorld.js?3bb4","webpack:///./Game.js?fe14","webpack:///./RuleSet.js?b516","webpack:///./Constants.js?7aaf"],"names":["OL","window","getEl","id","document","getElementById","uploadFile","file","url","onLoad","onError","xhr","XMLHttpRequest","onload","onerror","open","overrideMimeType","type","setRequestHeader","send","init","artStyles","selectedStyle","resize","on","onresize","map","spriteSheets","name","mode","exhibit","data","sprites","user","concat","shareButton","style","display","onclick","mapVal","value","rows","trim","split","length","alert","tempCanvas","createElement","tmpCtx","getContext","size","fillStyle","font","bounds","measureText","width","ySize","Math","floor","height","forEach","row","i","fillText","thumbnail","toDataURL","share","artStylesSelect","option","text","appendChild","customOption","uploadButton","files","dataset","loading","create","response","storageKey","uploadURL","getURLs","urls","newStyle","unshift","newOption","insertBefore","firstChild","onchange","evt","selected","target","selectedIndex","isEditorOpen","gameState","canvas","spriteSheet","log","updateLog","logDisplay","innerText","scrollTop","scrollHeight","initIcons","inventoryIcons","Array","from","getElementsByTagName","iconPositions","axe","key","dynamite","raft","gold","gridSize","gridWidth","pos","icon","offsetWidth","backgroundImage","backgroundSize","backgroundPosition","addEventListener","onChange","grid","inventory","visited","isGameOver","message","windowStr","inventoryItems","symbol","Key","Stone","Axe","Gold","Raft","Dynamite","item","element","count","inventoryItem","game","gridWorld","actionButtons","l","r","f","c","u","b","actionHandler","action","e","performAction","Object","keys","onblur","stop","onfocus","run","hasModified","onkeydown","activeElement","tagName","speed","keyCode","pan","charCodeAt","revealMap","dragStart","startDrag","clientX","clientY","rect","getBoundingClientRect","x","left","y","top","endDrag","moveDrag","onmouseup","onmousemove","onmousedown","preventDefault","touch","changedTouches","closeEditor","openEditor","logInteraction","loadMap","theme","changeSprites","loadState","err","val","toLowerCase","substring","Tile","orientation","symbolMap","Ground","Tree","Stump","Start","Empty","Wall","Door","DoorOpen","Water","Wilson","Exploded","tile","feature","linkN","linkS","linkE","linkW","n","s","w","tileCondition","X","WX","EX","SX","NX","NW","NE","SW","SE","NS","EW","S","N","W","E","A","filter","isGround","waterN","waterS","waterE","waterW","groundN","groundS","groundE","groundW","SU","NU","WU","EU","O","result","layer","prefix","Symbol","keyFor","bounding","getBoundingType","linking","getLinkingType","includes","RogueGame","stateString","startingState","layers","createLayers","sheet","fill","stroke","explosions","isStartingState","parse","isWin","index","ruleset","setState","update","push","perform","reason","toUpperCase","updateVisited","changeLayers","getWindow","py","player","px","inBounds","cell","startCell","mapData","indexOf","wallFeatures","featurePresent","features","notFeatures","assign","backgroundLayer","tiles","getLayer","foregroundLayer","wallLayer","extrasLayer","playerLayer","visibleLayer","visitedLayer","windStr","tileToChar","wx","wy","North","South","West","East","slice","fillExtraFeatures","calculateOrientation","findPlayer","NORTH","SOUTH","EAST","WEST","GridWorld","initData","gridHeight","background","gridPan","loadSprites","spritesheet","spriteSheetUrl","src","Image","image","dt","drag","gridDx","gridDy","dx","dy","ctx","context","scale","offsetX","offsetY","textWidth","sprite","imageSmoothingEnabled","gridI","strokeStyle","strokeRect","complete","drawImage","fillRect","clearRect","drawLayer","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","setTimeout","callback","cancelAnimationFrame","webkitCancelAnimationFrame","mozCancelAnimationFrame","oCancelAnimationFrame","msCancelAnimationFrame","clearTimeout","Game","new","TypeError","Error","position","innerWidth","max","innerHeight","running","frameRequest","processFrame","step","lastStep","Date","now","draw","PassableTerrain","RuleSet","coord","iToCoord","coordToI","dir","facing","inFront","actions","oldLocation","location","canMove","inventoryAt","splice","pickups","tileDirs","north","south","east","west","link","delegate","TileTypes","for","FeatureTypes","PlayerChars","PlayerDirections","InventoryTypes"],"mappings":"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","file":"app.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 48c883a087923475c728\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 48c883a087923475c728","import RogueGame from './RogueGame.js';\nimport {InventoryTypes} from './Constants';\n\nconst OL = window.OL;\nconst getEl = (id) => document.getElementById(id);\n\nconst uploadFile = (file, url, onLoad, onError) => {\n  const xhr = new XMLHttpRequest();\n\n  xhr.onload = onLoad;\n  xhr.onerror = onError;\n\n  xhr.open('PUT', url);\n  xhr.overrideMimeType(file.type);\n  xhr.setRequestHeader('Access-Control-Allow-Origin', '*');\n  xhr.setRequestHeader('Access-Control-Expose-Headers', 'Access-Control-Allow-Origin');\n  xhr.send(file);\n};\n\nconst init = () => {\n  let artStyles = [];\n  let selectedStyle = 0;\n  if (OL) {\n    OL.resize(720, true);\n    OL.on('resize', () => {\n      window.onresize();\n    });\n    // Running as OpenLearning widget\n    let map;\n    let spriteSheets = [{\n        name: 'Robot in the Wilderness',\n        url: 'assets/sprites.png'\n      },\n      {\n        name: 'I drew this in MS Paint',\n        url: 'assets/sprites2.png'\n      }\n    ];\n\n    if (OL.mode === 'exhibit') {\n      map = OL.exhibit.data.map;\n      spriteSheets = OL.exhibit.data.sprites;\n      selectedStyle = OL.exhibit.data.selectedStyle || 0;\n    } else if (OL.user.data) {\n      map = OL.user.data.map;\n      spriteSheets = spriteSheets.concat(OL.user.data.sprites || []);\n      selectedStyle = OL.user.data.selectedStyle || 0;\n\n      const shareButton = getEl('editor-share');\n      shareButton.style.display = '';\n      shareButton.onclick = () => {\n        const mapVal = getEl('edit-text').value;\n        const rows = mapVal.trim().split('\\n');\n\n        if (rows.length === 0) {\n          alert('Please enter a map to share');\n          return;\n        }\n\n        const tempCanvas = document.createElement('canvas');\n        const tmpCtx = tempCanvas.getContext('2d');\n        const size = 14;\n\n        tmpCtx.fillStyle = 'black';\n        tmpCtx.font = size + 'px monospace';\n        const bounds = tmpCtx.measureText(rows[0]);\n        tempCanvas.width = bounds.width;\n        const ySize = Math.floor(bounds.width/rows[0].length);\n        tempCanvas.height = rows.length * ySize;\n        tmpCtx.font = size + 'px monospace';\n\n        rows.forEach((row, i) => {\n          tmpCtx.fillText(row, 0, i * ySize);\n        })\n        const thumbnail = tempCanvas.toDataURL();\n\n        OL.user.share('widget', {\n          thumbnail: thumbnail,\n          map: mapVal,\n          sprites: artStyles,\n          selectedStyle: selectedStyle\n        });\n      };\n    }\n\n    if (map) {\n      getEl('edit-text').value = map;\n    }\n\n    if (spriteSheets && spriteSheets.length > 0) {\n      artStyles = spriteSheets;\n    }\n  }\n\n  const artStylesSelect = getEl('theme');\n  artStyles.forEach((style, i) => {\n    const option = document.createElement('option');\n    option.text = style.name;\n    option.value = style.url;\n    artStylesSelect.appendChild(option);\n  });\n\n  if (OL && OL.mode === 'display') {\n    const customOption = document.createElement('option');\n    customOption.text = 'Custom: Upload your own';\n    customOption.value = 'CUSTOM';\n    artStylesSelect.appendChild(customOption);\n\n    const uploadButton = getEl('theme-save');\n    uploadButton.onclick = () => {\n      const file = getEl('theme-file').files[0];\n\n      if (file) {\n        uploadButton.dataset.loading = 'true';\n        OL.files.create('sprites.png', function(response) {\n          var storageKey = response.storageKey;\n          var uploadURL  = response.uploadURL;\n          uploadFile(file, uploadURL, () => {\n            OL.files.getURLs([storageKey], (urls) => {\n              uploadButton.dataset.loading = 'false';\n              const newStyle = {\n                name: getEl('theme-name').value,\n                url: urls[0]\n              };\n              artStyles.unshift(newStyle);\n              const newOption = document.createElement('option');\n              newOption.text = newStyle.name;\n              newOption.value = newStyle.url;\n              artStylesSelect.insertBefore(newOption, artStylesSelect.firstChild);\n              artStylesSelect.value = newStyle.url;\n              selectedStyle = 0;\n              getEl('theme-upload').style.display = 'none';\n            });\n          });\n        });\n      }\n    };\n  }\n\n  artStylesSelect.onchange = (evt) => {\n    const selected = evt.target;\n    if (selected.selectedIndex >= artStyles.length) {\n      getEl('theme-upload').style.display = '';\n      getEl('theme-name').value = '';\n    } else {\n      getEl('theme-upload').style.display = 'none';\n      selectedStyle = selected.selectedIndex;\n    }\n  };\n\n  artStylesSelect.value = artStyles[selectedStyle].url;\n\n\n  let isEditorOpen = false;\n\n  let gameState = getEl('edit-text').value;\n\n  const canvas = getEl('gameCanvas');\n  let spriteSheet = artStyles[selectedStyle].url;\n  let log = '';\n  const updateLog = () => {\n    const logDisplay = getEl('log');\n    logDisplay.innerText = log.trim();\n    logDisplay.scrollTop = logDisplay.scrollHeight;\n  };\n\n\n  const initIcons = () => {\n    const inventoryIcons = Array.from(getEl('inventory').getElementsByTagName(\"LI\"));\n    const iconPositions = {\n      axe: [0, 0],\n      key: [2, 2],\n      dynamite: [6, 0],\n      raft: [3, 3],\n      gold: [7, 0]\n    };\n    const gridSize = 64;\n    const gridWidth = 8;\n    inventoryIcons.forEach(icon => {\n      const pos = iconPositions[icon.id];\n      const size = icon.offsetWidth < 50 ? 32 : 64;\n\n      if (pos) {\n        icon.style.backgroundImage = `url(\"${spriteSheet}\")`;\n        icon.style.backgroundSize = `${size * gridWidth}px`;\n        icon.style.backgroundPosition = `${-pos[0] * size}px ${-pos[1] * size}px`;\n      }\n    });\n  };\n  initIcons();\n  window.addEventListener('resize', () => {\n    initIcons();\n  });\n\n  const onChange = (grid, inventory, visited, isGameOver, message, windowStr) => {\n    getEl('agent-window').innerText = windowStr;\n\n    const inventoryItems = [\n      {\n        id: 'key',\n        symbol: InventoryTypes.Key\n      },\n      {\n        id: 'stone',\n        symbol: InventoryTypes.Stone\n      },\n      {\n        id: 'axe',\n        symbol: InventoryTypes.Axe\n      },\n      {\n        id: 'gold',\n        symbol: InventoryTypes.Gold\n      },\n      {\n        id: 'raft',\n        symbol: InventoryTypes.Raft\n      },\n      {\n        id: 'dynamite',\n        symbol: InventoryTypes.Dynamite\n      },\n    ];\n\n    inventoryItems.forEach((item) => {\n      const element = getEl(item.id);\n      let count = 0;\n      inventory.forEach(inventoryItem => {\n        if (inventoryItem === item.symbol) {\n          count++;\n        }\n      });\n\n      if (count > 0) {\n        element.style.display = '';\n        if (count > 1) {\n          element.innerText = count;\n        } else {\n          element.innerText = '';\n        }\n      } else {\n        element.style.display = 'none';\n      }\n    });\n\n    if (message || isGameOver) {\n      log += message + '\\n';\n      if (isGameOver) {\n        log += 'Game Over.\\n\\n';\n      }\n\n      updateLog();\n    }\n  };\n\n  const game = new RogueGame(canvas, gameState, spriteSheet, onChange);\n  const gridWorld = game.gridWorld;\n\n\n  const actionButtons = {\n    l: getEl('action-l'),\n    r: getEl('action-r'),\n    f: getEl('action-f'),\n    c: getEl('action-c'),\n    u: getEl('action-u'),\n    b: getEl('action-b')\n  };\n\n  const actionHandler = (action) => (e) => game.performAction(action);\n\n  Object.keys(actionButtons).forEach((key) => {\n    actionButtons[key].onclick = actionHandler(key);\n  });\n\n  window.onblur = () => gridWorld.stop();\n  window.onfocus = () => gridWorld.run();\n  window.onresize = () => gridWorld.hasModified = true;\n  window.onkeydown = (e) => {\n    if (isEditorOpen) return;\n    if (document.activeElement.tagName === 'INPUT') return;\n\n    const speed = 8;\n    switch (e.keyCode) {\n      case 38: gridWorld.pan(0, -speed); break;\n      case 40: gridWorld.pan(0,  speed); break;\n      case 37: gridWorld.pan(-speed, 0); break;\n      case 39: gridWorld.pan(speed,  0); break;\n      case 'L'.charCodeAt(0): game.performAction('l'); break;\n      case 'R'.charCodeAt(0): game.performAction('r'); break;\n      case 'F'.charCodeAt(0): game.performAction('f'); break;\n      case 'C'.charCodeAt(0): game.performAction('c'); break;\n      case 'U'.charCodeAt(0): game.performAction('u'); break;\n      case 'B'.charCodeAt(0): game.performAction('b'); break;\n\n      case 'A'.charCodeAt(0): game.performAction('l'); break;\n      case 'D'.charCodeAt(0): game.performAction('r'); break;\n      case 'W'.charCodeAt(0): game.performAction('f'); break;\n      case 'Q'.charCodeAt(0): game.performAction('c'); break;\n      case 'E'.charCodeAt(0): game.performAction('u'); break;\n      case 'S'.charCodeAt(0): game.performAction('b'); break;\n\n      case '0'.charCodeAt(0): game.revealMap(); break;\n      default: break;\n    }\n  }\n\n  let dragStart = null;\n  const startDrag = (clientX, clientY) => {\n    const rect = canvas.getBoundingClientRect();\n    dragStart = {\n      x: clientX - rect.left,\n      y: clientY - rect.top,\n      rect: rect\n    };\n    gridWorld.startDrag(dragStart.x, dragStart.y);\n  };\n  const endDrag = () => {\n    dragStart = null;\n  };\n  const moveDrag = (clientX, clientY) => {\n    if (dragStart) {\n      gridWorld.moveDrag(\n        clientX - dragStart.rect.left,\n        clientY - dragStart.rect.top\n      );\n    }\n  };\n  window.onmouseup = (e) => {\n    endDrag();\n  };\n  window.onmousemove = (e) => {\n    moveDrag(e.clientX, e.clientY);\n  };\n  canvas.onmousedown = (e) => {\n    startDrag(e.clientX, e.clientY);\n  };\n  canvas.addEventListener('touchstart', (e) => {\n    e.preventDefault();\n    const touch = e.changedTouches[0];\n    if (!touch) return;\n    startDrag(touch.clientX, touch.clientY);\n  });\n  canvas.addEventListener('touchend', (e) => {\n    endDrag();\n  });\n  canvas.addEventListener('touchcancel', (e) => {\n    endDrag();\n  });\n  canvas.addEventListener('touchmove', (e) => {\n    e.preventDefault();\n    const touch = e.changedTouches[0];\n    if (!touch) return;\n    moveDrag(touch.clientX, touch.clientY);\n  });\n\n  const closeEditor = () => {\n    getEl('editor').style.display = 'none';\n    isEditorOpen = false;\n  };\n  const openEditor = () => {\n    if (OL) OL.user.logInteraction();\n\n    getEl('editor').style.display = '';\n    isEditorOpen = true;\n  };\n\n  getEl('close-editor').onclick = closeEditor;\n  getEl('edit').onclick = openEditor;\n\n  const loadMap = () => {\n    gameState = getEl('edit-text').value;\n    const theme = getEl('theme').value;\n\n    if (theme === 'CUSTOM') {\n      alert(\"No theme uploaded.\");\n    } else {\n      try {\n        spriteSheet = theme;\n        gridWorld.changeSprites(theme);\n        initIcons();\n        game.loadState(gameState, [], []);\n        getEl('editor').style.display = 'none';\n        isEditorOpen = false;\n      } catch (err) {\n        //throw err;\n        alert(err);\n      }\n    }\n  };\n\n  getEl('editor-save').onclick = loadMap;\n\n  getEl('reset').onclick = () => {\n    log = 'Reset.\\n';\n    updateLog();\n    try {\n      game.loadState(gameState, [], []);\n    } catch (err) {\n      alert(err);\n    }\n  };\n\n  getEl('instructions-run').onclick = () => {\n    const val = getEl('instructions-input').value;\n    if (val.length === 0) {\n      return;\n    }\n    game.performAction(val[0].toLowerCase());\n    getEl('instructions-input').value = val.substring(1);\n  };\n\n  gridWorld.run();\n};\n\n\nwindow.onload = () => {\n  if (OL) {\n    OL(init);\n  } else {\n    init();\n  }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./index.js\n\n\n// WEBPACK FOOTER //\n// ./index.js","import GridWorld from './GridWorld.js';\nimport RuleSet from './RuleSet.js';\nimport {TileTypes, FeatureTypes, InventoryTypes, PlayerChars, PlayerDirections} from './Constants.js';\n\nclass Tile {\n  constructor(symbol, orientation = null) {\n    const symbolMap = {\n      'T': [TileTypes.Ground, FeatureTypes.Tree],\n      't': [TileTypes.Ground, FeatureTypes.Stump], // extra, shimmed in\n      'a': [TileTypes.Ground, FeatureTypes.Axe],\n      'k': [TileTypes.Ground, FeatureTypes.Key],\n      // 'o': [TileTypes.Ground, FeatureTypes.Stone],\n      '$': [TileTypes.Ground, FeatureTypes.Gold],\n      'x': [TileTypes.Ground, FeatureTypes.Start], // extra, shimmed in\n      ' ': [TileTypes.Ground, FeatureTypes.Empty],\n      '-': [TileTypes.Wall,   FeatureTypes.Door],\n      '!': [TileTypes.Wall,   FeatureTypes.DoorOpen], // extra, shimmed in\n      '*': [TileTypes.Wall,   FeatureTypes.Wall],\n      '~': [TileTypes.Water,  FeatureTypes.Empty],\n      // 'O': [TileTypes.Water,  FeatureTypes.Stone],\n      'd': [TileTypes.Ground, FeatureTypes.Dynamite],\n      'w': [TileTypes.Ground, FeatureTypes.Wilson], // ???\n      'D': [TileTypes.Ground, FeatureTypes.Exploded] // extra, shimmed in\n    };\n\n    const [tile, feature] = symbolMap[symbol];\n\n    this.tile = tile;\n    this.feature = feature;\n    this.orientation = orientation;\n  }\n\n  getLinkingType() {\n    if (this.orientation === null) return null;\n\n    const {linkN, linkS, linkE, linkW} = this.orientation;\n    const [n, s, e, w] = [linkN, linkS, linkE, linkW];\n\n    // Name for every linking type, as a combination of N/S/E/W\n    const tileCondition = {\n      X:  n &&  s &&  e &&  w,\n\n      WX: n &&  s &&  e && !w,\n      EX: n &&  s && !e &&  w,\n      SX: n && !s &&  e &&  w,\n      NX:!n &&  s &&  e &&  w,\n\n      NW:!n &&  s &&  e && !w,\n      NE:!n &&  s && !e &&  w,\n      SW: n && !s &&  e && !w,\n      SE: n && !s && !e &&  w,\n\n      NS: n &&  s && !e && !w,\n      EW:!n && !s &&  e &&  w,\n\n      S:  n && !s && !e && !w,\n      N: !n &&  s && !e && !w,\n      W: !n && !s &&  e && !w,\n      E: !n && !s && !e &&  w,\n\n      A: !n && !s && !e && !w\n    };\n\n    return Object.keys(tileCondition).filter((key) => tileCondition[key])[0];\n  }\n\n  getBoundingType(isGround=false) {\n    if (this.orientation === null) return null;\n\n    const {\n      waterN, waterS, waterE, waterW,\n      groundN, groundS, groundE, groundW\n    } = this.orientation;\n\n    const [n, s, e, w] = isGround ?\n      [groundN, groundS, groundE, groundW] :\n      [waterN, waterS, waterE, waterW];\n\n    // Name for every bounding type, as a combination of N/S/E/W\n    const tileCondition = {\n      NW:!n &&  s &&  e && !w,\n      NE:!n &&  s && !e &&  w,\n      SW: n && !s &&  e && !w,\n      SE: n && !s && !e &&  w,\n\n      SU:  n && !s && !e && !w,\n      NU: !n &&  s && !e && !w,\n      WU: !n && !s &&  e && !w,\n      EU: !n && !s && !e &&  w,\n\n      O: !n && !s && !e && !w\n    };\n\n    const result = Object.keys(tileCondition).filter((key) => tileCondition[key]);\n\n    if (result.length === 1) {\n      return result[0];\n    } else {\n      return null;\n    }\n  }\n\n  getLayer(layer) {\n    let prefix = null;\n    let key = null;\n\n    if (layer === 0) {\n      if (this.tile === TileTypes.Water) {\n        key = Symbol.keyFor(TileTypes.Water);\n      } else {\n        key = Symbol.keyFor(TileTypes.Ground);\n      }\n\n      const bounding = this.getBoundingType(this.tile !== TileTypes.Water);\n      if (bounding) {\n        key = bounding + '-' + key;\n      }\n    } else if (layer === 1 && this.tile !== TileTypes.Wall) {\n      key = Symbol.keyFor(this.tile);\n\n      if (this.feature === FeatureTypes.Empty) {\n        prefix = null;\n      } else {\n        prefix = Symbol.keyFor(this.feature);\n      }\n\n      if (key !== null && prefix !== null) {\n        key = prefix + '-' + key;\n      } else {\n        key = null;\n      }\n    } else if (layer === 2 && this.tile === TileTypes.Wall) {\n      let linking = this.getLinkingType();\n      if (this.feature === FeatureTypes.Door || this.feature === FeatureTypes.DoorOpen) {\n        if (['S', 'N', 'SX', 'NX', 'NS'].includes(linking)) {\n          linking = 'NS';\n        } else {\n          linking = 'EW';\n        }\n      }\n      key = linking + '-' + Symbol.keyFor(this.feature);\n    }\n\n    return key;\n  }\n}\n\nexport default class RogueGame {\n  constructor(canvas, stateString, spriteSheet, onChange) {\n    this.canvas = canvas;\n    this.onChange = onChange;\n    this.startingState = null;\n    this.loadState(stateString);\n    const layers = this.createLayers(this.grid);\n    const [width, height] = [this.grid.width, this.grid.height];\n\n    this.gridWorld = new GridWorld(this.canvas, {\n      \"width\": width,\n      \"height\": height,\n      \"size\": 64,\n      \"pan\": [width / 2, height / 2],\n      \"grid\": layers,\n      \"spritesheet\": spriteSheet,\n      \"sprites\": {\n        \"Axe-Ground\":      {sheet: {x: 0, y: 0}},\n        \"Exploded-Ground\": {sheet: {x: 1, y: 0}},\n        \"EW-Door\":         {sheet: {x: 2, y: 0}},\n        \"NS-Door\":         {sheet: {x: 3, y: 0}},\n        \"EW-DoorOpen\":     {sheet: {x: 4, y: 0}},\n        \"NS-DoorOpen\":     {sheet: {x: 5, y: 0}},\n        \"Dynamite-Ground\": {sheet: {x: 6, y: 0}},\n        \"Gold-Ground\":     {sheet: {x: 7, y: 0}},\n\n        \"EU-Ground\": {sheet: {x: 0, y: 1}},\n        \"NE-Ground\": {sheet: {x: 1, y: 1}},\n        \"NU-Ground\": {sheet: {x: 2, y: 1}},\n        \"NW-Ground\": {sheet: {x: 3, y: 1}},\n        \"O-Ground\":  {sheet: {x: 4, y: 1}},\n        \"SE-Ground\": {sheet: {x: 5, y: 1}},\n        \"SU-Ground\": {sheet: {x: 6, y: 1}},\n        \"SW-Ground\": {sheet: {x: 7, y: 1}},\n\n        \"WU-Ground\":  {sheet: {x: 0, y: 2}},\n        \"Ground\":     {sheet: {x: 1, y: 2}},\n        \"Key-Ground\": {sheet: {x: 2, y: 2}},\n\n        \"a>\": {sheet: {x: 3, y: 2}},\n        \"a^\": {sheet: {x: 4, y: 2}},\n        \"av\": {sheet: {x: 5, y: 2}},\n        \"a<\": {sheet: {x: 6, y: 2}},\n        \">\":  {sheet: {x: 7, y: 2}},\n        \"^\":  {sheet: {x: 0, y: 3}},\n        \"v\":  {sheet: {x: 1, y: 3}},\n        \"<\":  {sheet: {x: 2, y: 3}},\n\n        \"Raft\": {sheet: {x: 3, y: 3}},\n\n        \"Start-Ground\": {sheet: {x: 4, y: 3}},\n        \"Stump-Ground\": {sheet: {x: 5, y: 3}},\n        \"Tree-Ground\":  {sheet: {x: 6, y: 3}},\n\n        \"A-Wall\": {sheet: {x: 7, y: 3}},\n\n        \"E-Wall\":  {sheet: {x: 0, y: 4}},\n        \"EW-Wall\": {sheet: {x: 1, y: 4}},\n        \"EX-Wall\": {sheet: {x: 2, y: 4}},\n\n        \"N-Wall\":  {sheet: {x: 3, y: 4}},\n        \"NE-Wall\": {sheet: {x: 4, y: 4}},\n        \"NS-Wall\": {sheet: {x: 5, y: 4}},\n        \"NW-Wall\": {sheet: {x: 6, y: 4}},\n        \"NX-Wall\": {sheet: {x: 7, y: 4}},\n\n        \"S-Wall\":  {sheet: {x: 0, y: 5}},\n        \"SE-Wall\": {sheet: {x: 1, y: 5}},\n        \"SW-Wall\": {sheet: {x: 2, y: 5}},\n        \"SX-Wall\": {sheet: {x: 3, y: 5}},\n\n        \"W-Wall\":  {sheet: {x: 4, y: 5}},\n        \"WX-Wall\": {sheet: {x: 5, y: 5}},\n        \"X-Wall\":  {sheet: {x: 6, y: 5}},\n\n        \"EU-Water\": {sheet: {x: 7, y: 5}},\n        \"NE-Water\": {sheet: {x: 0, y: 6}},\n        \"NU-Water\": {sheet: {x: 1, y: 6}},\n        \"NW-Water\": {sheet: {x: 2, y: 6}},\n        \"O-Water\":  {sheet: {x: 3, y: 6}},\n        \"SE-Water\": {sheet: {x: 4, y: 6}},\n        \"SU-Water\": {sheet: {x: 5, y: 6}},\n        \"SW-Water\": {sheet: {x: 6, y: 6}},\n        \"WU-Water\": {sheet: {x: 7, y: 6}},\n        \"Water\": {sheet: {x: 0, y: 7}},\n        \"Wilson-Ground\": {sheet: {x: 1, y: 7}},\n\n        \"Unseen\": {fill: 'rgba(0, 0, 0, 0.4)', stroke: 'rgba(96, 96, 96, 0.8)'},\n        \"Unvisited\": {fill: 'rgba(0, 0, 0, 0.8)', stroke: 'rgba(32, 32, 32, 0.8)'}\n      }\n    });\n  }\n\n  loadState(stateString, visited=null, inventory=null, explosions=null, isStartingState=true) {\n    this.explosions = [];\n\n    if (explosions) {\n      this.explosions = explosions;\n    }\n\n    if (isStartingState) {\n      this.startingState = null;\n    }\n\n    try {\n      this.grid = this.parse(stateString);\n    } catch (err) {\n      throw \"Unable to parse the map.\";\n    }\n\n    this.isGameOver = false;\n    this.isWin = false;\n    this.visited = Array(this.grid.width * this.grid.height).fill('Unvisited');\n\n    if (inventory) {\n      this.inventory = inventory;\n    }\n\n    if (!this.inventory) {\n      this.inventory = [];\n    }\n\n    if (visited) {\n      visited.forEach((value, index) => this.visited[index] = null);\n    }\n\n    if (!this.ruleset) {\n      this.ruleset = new RuleSet(this.grid, this.inventory, this.explosions);\n    } else {\n      this.ruleset.setState(this.grid, this.inventory, this.explosions);\n    }\n\n    this.update('Map Loaded.');\n  }\n\n  getVisited() {\n    const visited = [];\n    this.visited.forEach((value, index) => {\n      if (value === null) visited.push(index);\n    });\n    return visited;\n  }\n\n  performAction(action) {\n    if (this.isGameOver || this.isWin) return;\n\n    let message;\n\n    try {\n      message = this.ruleset.perform(action);\n      if (message === true) {\n        this.isWin = true;\n      }\n    } catch (err) {\n      if (err.type === 'dead') {\n        if (err.reason === 'drowned') {\n          message = 'Agent fell into water and drowned';\n        } else if (err.reason === 'outside') {\n          message = 'Agent wandered off and got lost in the wilderness';\n        } else {\n          message = 'Agent died... somehow';\n        }\n\n        this.isGameOver = true;\n      } else {\n        throw err;\n      }\n    }\n\n    if (message === true) {\n      message = 'Gold has been collected.\\nMission successful!\\n';\n    }\n\n    this.update(action.toUpperCase() + ': ' + message);\n  }\n\n  update(message) {\n    this.updateVisited(this.grid);\n\n    if (this.gridWorld) {\n      const layers = this.createLayers(this.grid);\n      const [width, height] = [this.grid.width, this.grid.height];\n\n      this.gridWorld.changeLayers(layers, width, height);\n      this.gridWorld.hasModified = true;\n    }\n\n    if (this.onChange) {\n      this.onChange(this.grid, this.inventory, this.visited, this.isGameOver || this.isWin, message, this.getWindow());\n    }\n  }\n\n  updateVisited(grid) {\n    const py = Math.floor(grid.player.index / grid.width);\n    const px = (grid.player.index % grid.width);\n    for (let y = py - 2; y <= py + 2; y++) {\n      for (let x = px - 2; x <= px + 2; x++) {\n        if (this.inBounds(x, y, grid)) {\n          this.visited[y * grid.width + x] = null;\n        }\n      }\n    }\n  }\n\n  fillExtraFeatures(cell, i) {\n    // infer hidden or unspecified features\n    const startCell = this.startingState[i];\n\n    if (PlayerChars.includes(cell)) {\n      // infer what cell the player is standing on\n      if (startCell === '~') {\n        // in the water\n        cell = 'O'; // player must be standing on a stone\n      } else if (startCell === '-') {\n        // in a doorway\n        cell = '-'; // player must be standing in a doorway\n      } else {\n        cell = ' '; // player must be standing on the ground\n      }\n    }\n\n    if (cell === ' ') {\n      if (startCell === 'T') {\n        // This was a tree when we started\n        cell = 't'; // now a stump\n      } else if (startCell === '-') {\n        // This was a doorway\n        cell = '!'; // now an open door\n      } else if (PlayerChars.includes(startCell)) {\n        // This is where the player started\n        cell = 'x'; // mark starting location\n      }\n    }\n\n    if (this.explosions.includes(cell)) {\n      cell = 'D';\n    }\n\n    return cell;\n  }\n\n  findPlayer(mapData) {\n    const player = {\n      index: null,\n      orientation: null\n    };\n\n    mapData.forEach((cell, i) => {\n      const orientation = PlayerChars.indexOf(cell);\n      if (orientation >= 0) {\n        player.index = i;\n        player.orientation = orientation;\n      }\n    });\n\n    return player;\n  }\n\n  calculateOrientation(cell, i, mapData, width, height) {\n    const wallFeatures = ['-', '!', '*'];\n    let orientation = {};\n\n    const featurePresent = (x, y, features, notFeatures) => {\n      if ((x >= 0 && x < width) && (y >= 0 && y < height)) {\n        if (features) {\n          return features.includes(mapData[y * width + x]);\n        } else {\n          return !notFeatures.includes(mapData[y * width + x]);\n        }\n      } else {\n        if (!features || features.includes('~')) {\n          return true;\n        } else {\n          return false;\n        }\n      }\n    }\n\n    const y = Math.floor(i / width);\n    const x = (i % width);\n\n    if (wallFeatures.includes(cell)) {\n      Object.assign(orientation, {\n        linkN: featurePresent(x, y - 1, wallFeatures),\n        linkS: featurePresent(x, y + 1, wallFeatures),\n        linkE: featurePresent(x + 1, y, wallFeatures),\n        linkW: featurePresent(x - 1, y, wallFeatures)\n      });\n    }\n\n    if (cell === '~') {\n      Object.assign(orientation, {\n        waterN: featurePresent(x, y - 1, ['~']),\n        waterS: featurePresent(x, y + 1, ['~']),\n        waterE: featurePresent(x + 1, y, ['~']),\n        waterW: featurePresent(x - 1, y, ['~'])\n      });\n    } else {\n      Object.assign(orientation, {\n        groundN: featurePresent(x, y - 1, null, ['~']),\n        groundS: featurePresent(x, y + 1, null, ['~']),\n        groundE: featurePresent(x + 1, y, null, ['~']),\n        groundW: featurePresent(x - 1, y, null, ['~'])\n      });\n    }\n\n    return orientation;\n  }\n\n  inBounds(x, y, grid) {\n    const [width, height] = [grid.width, grid.height];\n    return (x >= 0 && x < width) && (y >= 0 && y < height);\n  }\n\n  createLayers(grid) {\n    const backgroundLayer = grid.tiles.map(tile => tile.getLayer(0));\n    const foregroundLayer = grid.tiles.map(tile => tile.getLayer(1));\n    const wallLayer       = grid.tiles.map(tile => tile.getLayer(2));\n    const extrasLayer     = Array(grid.width * grid.height).fill(null);\n    const playerLayer     = Array(grid.width * grid.height).fill(null);\n    const visibleLayer    = Array(grid.width * grid.height).fill('Unseen');\n    const visitedLayer    = this.visited;\n\n    if (!this.isGameOver) {\n\n      if (this.inventory.includes(InventoryTypes.Axe)) {\n        playerLayer[grid.player.index] = 'a' + PlayerChars[grid.player.orientation];\n      } else {\n        playerLayer[grid.player.index] = PlayerChars[grid.player.orientation];\n      }\n      if (\n        this.inventory.includes(InventoryTypes.Raft) &&\n        grid.tiles[grid.player.index].tile === TileTypes.Water\n      ) {\n        extrasLayer[grid.player.index] = 'Raft';\n      }\n    }\n\n    const py = Math.floor(grid.player.index / grid.width);\n    const px = (grid.player.index % grid.width);\n    for (let y = py - 2; y <= py + 2; y++) {\n      for (let x = px - 2; x <= px + 2; x++) {\n        if (this.inBounds(x, y, grid)) {\n          visibleLayer[y * grid.width + x] = null;\n        }\n      }\n    }\n\n    return [backgroundLayer, foregroundLayer, wallLayer, extrasLayer, playerLayer, visibleLayer, visitedLayer, null];\n  }\n\n  revealMap() {\n    this.visited = Array(this.grid.width * this.grid.height).fill(null);\n    this.update('Revealed Map');\n  }\n\n  getWindow() {\n    const grid = this.grid;\n    const py = Math.floor(grid.player.index / grid.width);\n    const px = (grid.player.index % grid.width);\n    const size = 5;\n    let windStr = '';\n\n    const tileToChar = (x, y) => {\n      const tile = grid.tiles[y * grid.width + x];\n      if (tile.tile === TileTypes.Ground) {\n        switch (tile.feature) {\n          case FeatureTypes.Tree:  return 'T';\n          case FeatureTypes.Axe:   return 'a';\n          case FeatureTypes.Key:   return 'k';\n          case FeatureTypes.Stone: return 'o';\n          case FeatureTypes.Gold:  return 'g';\n          case FeatureTypes.Dynamite: return 'd';\n          case FeatureTypes.Wilson: return '?';\n          default: return ' ';\n        }\n      } else if (tile.tile === TileTypes.Wall) {\n        switch (tile.feature) {\n          case FeatureTypes.Door:  return '-';\n          default: return '*';\n        }\n      } else if (tile.tile === TileTypes.Water) {\n        switch (tile.feature) {\n          case FeatureTypes.Stone: return 'O';\n          default: return '~';\n        }\n      }\n    };\n\n    for (let i = 0; i < size*size; ++i) {\n      if (i % size === 0 && i !== 0) {\n          windStr += '\\n';\n      }\n\n      const [wx, wy] = [i % size - 2, Math.floor(i / size) - 2];\n      let x, y;\n\n      switch (grid.player.orientation) {\n        case PlayerDirections.North: x = px + wx, y = py + wy; break;\n        case PlayerDirections.South: x = px - wx, y = py - wy; break;\n        case PlayerDirections.West : x = px + wy, y = py - wx; break;\n        case PlayerDirections.East : x = px - wy, y = py + wx; break;\n      }\n\n      if (this.inBounds(x, y, grid)) {\n        windStr += tileToChar(x, y);\n      } else {\n        windStr += '.';\n      }\n    }\n\n    return windStr;\n  }\n\n  parse(stateString) {\n    const rows   = stateString.split('\\n').filter(row => row.length > 0);\n    const height = rows.length;\n    const width  = rows[0].length;\n    const data   = [];\n\n    rows.forEach(row => {\n      if (row.length === width) {\n        row.split('').forEach(cell => data.push(cell));\n      } else {\n        throw \"Incorrect width\";\n      }\n    });\n\n    if (!this.startingState) {\n      this.startingState = data.slice();\n    }\n\n    const tiles = data.map((cell, i) => {\n      cell = this.fillExtraFeatures(cell, i);\n      const orientation = this.calculateOrientation(cell, i, data, width, height);\n      return new Tile(cell, orientation);\n    });\n\n    const player = this.findPlayer(data);\n\n    return {\n      width: width,\n      height: height,\n      tiles: tiles,\n      player: player\n    };\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./RogueGame.js\n\n\n// WEBPACK FOOTER //\n// ./RogueGame.js","import Game from './Game.js';\n\nconst NORTH = 0;\nconst SOUTH = 1;\nconst EAST = 2;\nconst WEST = 3;\n\nexport default class GridWorld extends Game {\n  /*\n    initData = {\n      \"width\": 2,\n      \"height\": 2,\n      \"size\": 64,\n      \"pan\": [1, 1],\n      \"grid\": [\n        \"a\", null,\n        null, \"b\"\n      ],\n      \"sprites\": {\n        \"a\": \"https://www.example.com/a.png\",\n        \"b\": [\n          \"https://www.example.com/b1.png\",\n          \"https://www.example.com/b2.png\",\n          \"https://www.example.com/b3.png\",\n          \"https://www.example.com/b4.png\"\n        ]\n      }\n    }\n  */\n  constructor(canvas, initData) {\n    super(canvas);\n    this.gridWidth = initData.width;\n    this.gridHeight = initData.height;\n    this.gridSize = initData.size;\n    this.background = initData.background || [];\n    this.grid = initData.grid || [[]];\n    for (const layer of this.grid) {\n      if (layer) {\n        layer.length = this.gridWidth * this.gridHeight;\n      }\n    }\n    this.gridPan = initData.pan || [Math.floor(gridWidth/2), Math.floor(gridHeight/2)];\n    this.loadSprites(initData.sprites, initData.spritesheet)\n    this.hasModified = true;\n  }\n\n  changeLayers(layers=this.grid, width=this.gridWidth, height=this.gridHeight, size=this.gridSize) {\n    this.grid = layers;\n    this.gridWidth = width;\n    this.gridHeight = height;\n    this.gridSize = size;\n  }\n\n  changeSprites(spriteSheetUrl) {\n    if (spriteSheetUrl) {\n      if (this.spritesheet && spriteSheetUrl === this.spritesheet.src) {\n        return;\n      }\n      this.spritesheet = new Image();\n      this.spritesheet.src = spriteSheetUrl;\n      this.spritesheet.onload = () => this.hasModified = true;\n    }\n  }\n\n  loadSprites(sprites, spritesheet) {\n    this.sprites = sprites || {};\n    Object.keys(this.sprites).forEach(key => {\n      if (typeof this.sprites[key] === 'string') {\n        const image = new Image();\n        image.src = this.sprites[key];\n        image.onload = () => this.hasModified = true;\n        this.sprites[key] = image;\n      }\n    });\n\n    this.changeSprites(spritesheet)\n  }\n\n  update(dt) {\n    return this.hasModified;\n  }\n\n  lookup(x, y) {\n    return this.grid[y * this.gridWidth + x];\n  }\n\n  startDrag(x, y) {\n    this.drag = {\n      x: x,\n      y: y,\n      pan: {\n        x: this.gridPan[0],\n        y: this.gridPan[1]\n      }\n    };\n  }\n\n  moveDrag(x, y) {\n    if (!this.drag) return;\n\n    const gridDx = -(x - this.drag.x)/this.gridSize;\n    const gridDy = -(y - this.drag.y)/this.gridSize;\n\n    this.gridPan[0] = this.drag.pan.x + gridDx;\n    this.gridPan[1] = this.drag.pan.y + gridDy;\n    this.hasModified = true;\n  }\n\n  endDrag(x, y) {\n    this.drag = null;\n  }\n\n  getPan() {\n    return {\n      x: this.gridPan[0] * this.gridSize,\n      y: this.gridPan[1] * this.gridSize\n    }\n  }\n\n  pan(dx, dy) {\n    this.gridPan[0] -= dx/this.gridSize;\n    this.gridPan[1] -= dy/this.gridSize;\n    this.hasModified = true;\n  }\n\n  panTo(x, y) {\n    this.gridPan[0] = x/this.gridSize;\n    this.gridPan[1] = y/this.gridSize;\n  }\n\n  drawLayer(layer) {\n    const ctx = this.context;\n    const scale = this.gridSize;\n    const offsetX = this.width /2 - this.gridPan[0] * scale;\n    const offsetY = this.height/2 - this.gridPan[1] * scale;\n\n    let x, y;\n    let textWidth, sprite;\n\n    ctx.font = `${scale/2}px sans-serif`;\n    ctx.imageSmoothingEnabled= false;\n\n    let gridI = 0;\n    while (gridI < this.gridWidth * this.gridHeight) {\n      y = offsetY + scale * Math.floor(gridI / this.gridWidth);\n      x = offsetX + scale * (gridI % this.gridWidth);\n\n      if (x < -scale || x > this.width + scale || y < -scale || y > this.height + scale) {\n        gridI++;\n        continue;\n      }\n\n      if (!layer) {\n        ctx.strokeStyle = '#666';\n        ctx.strokeRect(x, y, scale, scale);\n      } else if (layer[gridI]) {\n        sprite = this.sprites[layer[gridI]];\n\n        if (sprite && sprite.complete && sprite instanceof Image) {\n          ctx.drawImage(sprite,\n            0, 0, scale, scale,\n            x, y, scale, scale\n          );\n        } else if (sprite) {\n          if (sprite.fill) {\n            ctx.fillStyle = sprite.fill;\n            ctx.fillRect(x, y, scale, scale);\n          }\n          if (sprite.stroke) {\n            ctx.strokeStyle = sprite.stroke;\n            ctx.strokeRect(x, y, scale, scale);\n          }\n          if (sprite.sheet) {\n            ctx.drawImage(this.spritesheet,\n              sprite.sheet.x * scale, sprite.sheet.y * scale, scale, scale,\n              x, y, scale, scale\n            );\n          }\n        } else {\n          textWidth = ctx.measureText(layer[gridI]).width;\n          ctx.fillText(layer[gridI], x + scale/2 - textWidth/2, y + 5*scale/8);\n        }\n      }\n\n      gridI++;\n    }\n  }\n\n  draw() {\n    const ctx = this.context;\n\n    ctx.clearRect(0, 0, this.width, this.height);\n    ctx.fillStyle = 'black';\n    ctx.fillRect(0, 0, this.width, this.height);\n\n    let layer;\n    for (layer of this.grid) {\n      this.drawLayer(layer)\n    }\n\n    this.hasModified = false;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./GridWorld.js\n\n\n// WEBPACK FOOTER //\n// ./GridWorld.js","const requestAnimationFrame = window.requestAnimationFrame ||\n  window.webkitRequestAnimationFrame ||\n  window.mozRequestAnimationFrame ||\n  window.oRequestAnimationFrame ||\n  window.msRequestAnimationFrame ||\n  (callback => window.setTimeout(callback, 1000 / 60))\n;\n\nconst cancelAnimationFrame = window.cancelAnimationFrame ||\n  window.webkitCancelAnimationFrame ||\n  window.mozCancelAnimationFrame ||\n  window.oCancelAnimationFrame ||\n  window.msCancelAnimationFrame ||\n  window.clearTimeout\n;\n\nexport default class Game {\n  constructor(canvas) {\n    if (new.target === Game) {\n      throw new TypeError(\"Cannot construct an abstract class\");\n    }\n\n    if (typeof canvas === 'string') {\n      this.canvas = document.getElementById(canvas);\n      if (!this.canvas) throw new Error(`Unable to find element with ID: ${canvas}`);\n    } else {\n      this.canvas = canvas;\n    }\n\n    this.canvas.style.position = \"absolute\";\n    this.canvas.style.top = \"0\";\n    this.canvas.style.left = \"0\";\n    this.context = this.canvas.getContext('2d');\n    const resize = () => {\n      this.canvas.width = window.innerWidth;\n      this.canvas.height = Math.max(window.innerHeight, 720);\n      this.width = this.canvas.width;\n      this.height = this.canvas.height;\n    };\n\n    window.addEventListener('resize', (e) => resize);\n    resize();\n\n    this.running = false;\n    this.frameRequest = null;\n  }\n\n  update(dt) {\n    throw new TypeError(\"Not Implemented: update method is required\");\n  }\n\n  draw() {\n    throw new TypeError(\"Not Implemented: draw method is required\");\n  }\n\n  run() {\n    if (this.running) return;\n\n    this.running = true;\n    const processFrame = () => {\n      this.step();\n      this.frameRequest = requestAnimationFrame(processFrame);\n    };\n\n    this.lastStep = Date.now();\n    this.frameRequest = requestAnimationFrame(processFrame);\n  }\n\n  stop() {\n    if (this.frameRequest) cancelAnimationFrame(this.frameRequest);\n    this.frameRequest = null;\n    this.running = false;\n  }\n\n  step() {\n    const now = Date.now();\n    const dt = (now - this.lastStep) / 1000;\n    this.lastStep = now;\n    if (this.update(dt) !== false) {\n      this.draw();\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./Game.js\n\n\n// WEBPACK FOOTER //\n// ./Game.js","import {TileTypes, FeatureTypes, PlayerChars, InventoryTypes} from './Constants.js';\n\nconst PassableTerrain = [\n  FeatureTypes.Empty,\n  FeatureTypes.Stump,\n  FeatureTypes.Start,\n  FeatureTypes.Axe,\n  FeatureTypes.Key,\n  FeatureTypes.Dynamite,\n  FeatureTypes.Gold,\n  FeatureTypes.Exploded\n];\n\nexport default class RuleSet {\n  constructor(grid, inventory, explosions) {\n    this.setState(grid, inventory, explosions);\n  }\n\n  setState(grid, inventory, explosions) {\n    this.grid = grid;\n    this.inventory = inventory;\n    this.explosions = explosions;\n  }\n\n  iToCoord(i) {\n    const x = (i % this.grid.width);\n    const y = Math.floor(i / this.grid.width);\n\n    return [x, y];\n  }\n\n  coordToI(coord) {\n    const [x, y] = coord;\n\n    if (!this.inBounds(x, y)) {\n      return -1;\n    } else {\n      return y * this.grid.width + x;\n    }\n  }\n\n  inBounds(x, y) {\n    const [width, height] = [this.grid.width, this.grid.height];\n    return (x >= 0 && x < width) && (y >= 0 && y < height);\n  }\n\n  north(i) {\n    const [x, y] = this.iToCoord(i);\n    return this.coordToI([x, y-1]);\n  }\n\n  south(i) {\n    const [x, y] = this.iToCoord(i);\n    return this.coordToI([x, y+1]);\n  }\n\n  west(i) {\n    const [x, y] = this.iToCoord(i);\n    return this.coordToI([x-1, y]);\n  }\n\n  east(i) {\n    const [x, y] = this.iToCoord(i);\n    return this.coordToI([x+1, y]);\n  }\n\n  perform(action) {\n    let message = null;\n\n    action = action.toLowerCase();\n\n    const dir = this.grid.player.orientation;\n    const index = this.grid.player.index;\n    const facing = [\n      'north', 'east', 'south', 'west'\n    ][dir];\n    const inFront = this[facing](index);\n\n    const actions = {\n      r: () => {\n        this.grid.player.orientation = (dir + 1) % 4;\n        message = 'Turned right.';\n      },\n\n      l: () => {\n        this.grid.player.orientation = (dir === 0) ? 3 : (dir - 1);\n        message = 'Turned left.';\n      },\n\n      f: () => {\n        if (inFront < 0) {\n          throw {\n            type: 'dead',\n            reason: 'outside'\n          };\n        }\n\n        const oldLocation = this.grid.tiles[index];\n        const location = this.grid.tiles[inFront];\n        const tile = location.tile;\n        const feature = location.feature;\n\n        let canMove = false;\n\n        if (tile === TileTypes.Ground) {\n          // moving on ground\n          if (PassableTerrain.includes(feature)) {\n            canMove = true;\n          } else {\n            message = 'Blocked by: ' + Symbol.keyFor(feature);\n          }\n          if (feature === FeatureTypes.Start && this.inventory.includes(InventoryTypes.Gold)) {\n            message = true;\n            const inventoryAt = this.inventory.indexOf(InventoryTypes.Gold);\n            this.inventory.splice(inventoryAt, 1);\n          }\n          if (oldLocation.tile === TileTypes.Water && canMove) {\n            // moving from water to ground\n            message = 'Raft broke.';\n            const inventoryAt = this.inventory.indexOf(InventoryTypes.Raft);\n            this.inventory.splice(inventoryAt, 1);\n          }\n        } else if (tile === TileTypes.Wall) {\n          if (feature === FeatureTypes.DoorOpen) {\n            canMove = true;\n          } else if (feature === FeatureTypes.Wall) {\n            message = 'Walked into a wall.';\n          } else if (feature === FeatureTypes.Door) {\n            message = 'Door is locked.';\n          }\n          if (oldLocation.tile === TileTypes.Water && canMove) {\n            // moving from water to doorway\n            message = 'Raft broke.';\n            const inventoryAt = this.inventory.indexOf(InventoryTypes.Raft);\n            this.inventory.splice(inventoryAt, 1);\n          }\n        } else if (tile === TileTypes.Water) {\n          if (this.inventory.includes(InventoryTypes.Raft)) {\n            // if you have a raft you can move on water\n            canMove = true;\n          } else {\n            throw {\n              type: 'dead',\n              reason: 'drowned'\n            };\n          }\n        }\n\n        if (canMove) {\n          this.grid.player.index = inFront;\n\n          const pickups = [FeatureTypes.Key, FeatureTypes.Axe, FeatureTypes.Dynamite, FeatureTypes.Gold];\n\n          if (tile === TileTypes.Ground && pickups.includes(location.feature)) {\n            this.inventory.push(location.feature);\n            message = 'Picked up: ' + Symbol.keyFor(location.feature);\n            location.feature = FeatureTypes.Empty;\n          }\n\n          if (!message) {\n            message = 'Moved forward.';\n          }\n        }\n      },\n\n      c: () => {\n        const location = this.grid.tiles[inFront];\n        const feature = location.feature;\n\n        if (\n          this.inventory.includes(InventoryTypes.Axe) &&\n          inFront >= 0 &&\n          feature === FeatureTypes.Tree\n        ) {\n          // chop down the tree\n          location.feature = FeatureTypes.Stump;\n          if (this.inventory.includes(InventoryTypes.Raft)) {\n            message = 'Chopped down a tree. Already have a raft.';\n          } else {\n            this.inventory.push(InventoryTypes.Raft);\n            message = 'Chopped down a tree and made a raft.';\n          }\n        } else {\n          message = 'Unable to chop.';\n        }\n      },\n\n      u: () => {\n        const location = this.grid.tiles[inFront];\n        const feature = location.feature;\n\n        if (\n          this.inventory.includes(InventoryTypes.Key) &&\n          inFront >= 0 &&\n          feature === FeatureTypes.Door\n        ) {\n          // unlock the door\n          location.feature = FeatureTypes.DoorOpen;\n          message = 'Unlocked a door.';\n        } else {\n          message = 'Unable to unlock.';\n        }\n      },\n\n      b: () => {\n        const location = this.grid.tiles[inFront];\n\n        if (\n          this.inventory.includes(InventoryTypes.Dynamite) &&\n          inFront >= 0 &&\n          (\n            location.tile === TileTypes.Wall ||\n            location.feature === FeatureTypes.Tree\n          )\n        ) {\n          if (location.tile === TileTypes.Wall) {\n            message = 'Blasted wall.';\n          } else {\n            message = 'Blasted tree.';\n          }\n          location.tile = TileTypes.Ground;\n          location.feature = FeatureTypes.Exploded;\n          this.explosions.push(inFront);\n\n          // hack to make walls click together properly\n          const tileDirs = {\n            n: [this.north(inFront), 'linkS'],\n            s: [this.south(inFront), 'linkN'],\n            e: [this.east(inFront), 'linkW'],\n            w: [this.west(inFront), 'linkE']\n          };\n          Object.keys(tileDirs).forEach(key => {\n            const [index, link] = tileDirs[key];\n            const cell = this.grid.tiles[index];\n            if (index >= 0 && cell.tile === TileTypes.Wall) {\n              cell.orientation[link] = false;\n            }\n          });\n\n          const inventoryAt = this.inventory.indexOf(InventoryTypes.Dynamite);\n          this.inventory.splice(inventoryAt, 1);\n        } else {\n          if (!this.inventory.includes(InventoryTypes.Dynamite)) {\n            message = 'No dynamite.';\n          } else {\n            message = 'Nothing to blow up.';\n          }\n        }\n      }\n    };\n\n    const delegate = actions[action];\n\n    if (delegate) {\n      delegate();\n    } else {\n      message = 'Unknown instruction.';\n    }\n\n    return message;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./RuleSet.js\n\n\n// WEBPACK FOOTER //\n// ./RuleSet.js","// Base background tile types\nexport const TileTypes = {\n  Water: Symbol.for('Water'),\n  Ground: Symbol.for('Ground'),\n  Wall: Symbol.for('Wall')\n};\n\n// Features which may be on tiles\nexport const FeatureTypes = {\n  Empty: Symbol.for('Empty'),\n  Tree: Symbol.for('Tree'),\n  Stump: Symbol.for('Stump'), // extra, shimmed in (for aesthetics)\n  Start: Symbol.for('Start'), // extra, shimmed in (for aesthetics)\n  Wall: Symbol.for('Wall'),\n  Door: Symbol.for('Door'),\n  DoorOpen: Symbol.for('DoorOpen'), // extra, shimmed in (for aesthetics)\n  Stone: Symbol.for('Stone'),\n  Axe: Symbol.for('Axe'),\n  Key: Symbol.for('Key'),\n  Gold: Symbol.for('Gold'),\n  Dynamite: Symbol.for('Dynamite'),\n  Exploded: Symbol.for('Exploded'),\n  Wilson: Symbol.for('Wilson')\n};\n\nexport const PlayerChars = ['^', '>', 'v', '<'];\n\nexport const PlayerDirections = {\n  North: 0,\n  East: 1,\n  South: 2,\n  West: 3\n};\n\nexport const InventoryTypes = {\n  Stone: Symbol.for('Stone'),\n  Axe: Symbol.for('Axe'),\n  Key: Symbol.for('Key'),\n  Gold: Symbol.for('Gold'),\n  Raft: Symbol.for('Raft'),\n  Dynamite: Symbol.for('Dynamite')\n};\n\n\n\n// WEBPACK FOOTER //\n// ./Constants.js\n\n\n// WEBPACK FOOTER //\n// ./Constants.js"],"sourceRoot":""}