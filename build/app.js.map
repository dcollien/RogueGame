{"version":3,"sources":["webpack:///webpack/bootstrap e028e642d48aab1b5785?f514","webpack:///./index.js?2645","webpack:///./RogueGame.js?9b46","webpack:///./GridWorld.js?3bb4","webpack:///./Game.js?fe14","webpack:///./RuleSet.js?b516","webpack:///./Constants.js?7aaf"],"names":["OL","window","getEl","id","document","getElementById","uploadFile","file","url","onLoad","onError","xhr","XMLHttpRequest","onload","onerror","open","overrideMimeType","type","setRequestHeader","send","init","artStyles","selectedStyle","resize","on","onresize","map","spriteSheets","name","mode","exhibit","data","sprites","user","concat","shareButton","style","display","onclick","mapVal","value","rows","trim","split","length","alert","tempCanvas","createElement","tmpCtx","getContext","size","fillStyle","font","bounds","measureText","width","height","forEach","row","i","fillText","thumbnail","toDataURL","console","log","share","artStylesSelect","option","text","appendChild","customOption","uploadButton","files","dataset","loading","create","response","storageKey","uploadURL","getURLs","urls","newStyle","unshift","newOption","insertBefore","firstChild","onchange","evt","selected","target","selectedIndex","isEditorOpen","gameState","canvas","spriteSheet","updateLog","logDisplay","innerText","scrollTop","scrollHeight","onChange","grid","inventory","visited","isGameOver","message","windowStr","inventoryItems","symbol","Key","Stone","Axe","Gold","Raft","Dynamite","item","element","count","inventoryItem","game","gridWorld","initIcons","inventoryIcons","Array","from","getElementsByTagName","iconPositions","axe","key","dynamite","raft","gold","pos","icon","backgroundImage","backgroundPosition","actionButtons","l","r","f","c","u","b","actionHandler","action","e","performAction","Object","keys","onblur","stop","onfocus","run","hasModified","onkeydown","speed","keyCode","pan","charCodeAt","revealMap","dragStart","onmousedown","rect","getBoundingClientRect","x","clientX","left","y","clientY","top","startDrag","onmouseup","onmousemove","moveDrag","closeEditor","openEditor","logInteraction","loadMap","theme","changeSprites","loadState","err","Tile","orientation","symbolMap","Ground","Tree","Stump","Start","Empty","Wall","Door","DoorOpen","Water","Wilson","Exploded","tile","feature","linkN","linkS","linkE","linkW","n","s","w","tileCondition","X","WX","EX","SX","NX","NW","NE","SW","SE","NS","EW","S","N","W","E","A","filter","isGround","waterN","waterS","waterE","waterW","groundN","groundS","groundE","groundW","SU","NU","WU","EU","O","result","layer","prefix","Symbol","keyFor","bounding","getBoundingType","linking","getLinkingType","includes","RogueGame","stateString","startingState","layers","createLayers","sheet","fill","stroke","explosions","isStartingState","parse","isWin","index","ruleset","setState","update","push","perform","reason","toUpperCase","updateVisited","changeLayers","getWindow","py","Math","floor","player","px","inBounds","cell","startCell","mapData","indexOf","wallFeatures","featurePresent","features","notFeatures","assign","backgroundLayer","tiles","getLayer","foregroundLayer","wallLayer","extrasLayer","playerLayer","visibleLayer","visitedLayer","windStr","tileToChar","wx","wy","North","South","West","East","slice","fillExtraFeatures","calculateOrientation","findPlayer","NORTH","SOUTH","EAST","WEST","GridWorld","initData","gridWidth","gridHeight","gridSize","background","gridPan","loadSprites","spritesheet","spriteSheetUrl","src","Image","image","dt","drag","gridDx","gridDy","dx","dy","ctx","context","scale","offsetX","offsetY","textWidth","sprite","imageSmoothingEnabled","gridI","strokeStyle","strokeRect","complete","drawImage","fillRect","clearRect","drawLayer","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","setTimeout","callback","cancelAnimationFrame","webkitCancelAnimationFrame","mozCancelAnimationFrame","oCancelAnimationFrame","msCancelAnimationFrame","clearTimeout","Game","new","TypeError","Error","position","innerWidth","max","innerHeight","running","frameRequest","processFrame","step","lastStep","Date","now","draw","PassableTerrain","RuleSet","coord","iToCoord","coordToI","toLowerCase","dir","facing","inFront","actions","oldLocation","location","canMove","inventoryAt","splice","pickups","tileDirs","north","south","east","west","link","delegate","TileTypes","for","FeatureTypes","PlayerChars","PlayerDirections","InventoryTypes"],"mappings":"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","file":"app.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap e028e642d48aab1b5785\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap e028e642d48aab1b5785","import RogueGame from './RogueGame.js';\nimport {InventoryTypes} from './Constants';\n\nconst OL = window.OL;\nconst getEl = (id) => document.getElementById(id);\n\nconst uploadFile = (file, url, onLoad, onError) => {\n  const xhr = new XMLHttpRequest();\n\n  xhr.onload = onLoad;\n  xhr.onerror = onError;\n\n  xhr.open('PUT', url);\n  xhr.overrideMimeType(file.type);\n  xhr.setRequestHeader('Access-Control-Allow-Origin', '*');\n  xhr.setRequestHeader('Access-Control-Expose-Headers', 'Access-Control-Allow-Origin');\n  xhr.send(file);\n};\n\nconst init = () => {\n  let artStyles = [];\n  let selectedStyle = 0;\n  if (OL) {\n    OL.resize(720);\n    OL.on('resize', () => {\n      window.onresize();\n    });\n    // Running as OpenLearning widget\n    let map;\n    let spriteSheets = [{\n        name: 'Robot in the Wilderness',\n        url: 'assets/sprites.png'\n      },\n      {\n        name: 'I drew this in MS Paint',\n        url: 'assets/sprites2.png'\n      }\n    ];\n\n    if (OL.mode === 'exhibit') {\n      map = OL.exhibit.data.map;\n      spriteSheets = OL.exhibit.data.sprites;\n      selectedStyle = OL.exhibit.data.selectedStyle || 0;\n    } else if (OL.user.data) {\n      map = OL.user.data.map;\n      spriteSheets = spriteSheets.concat(OL.user.data.sprites || []);\n      selectedStyle = OL.user.data.selectedStyle || 0;\n\n      const shareButton = getEl('editor-share');\n      shareButton.style.display = '';\n      shareButton.onclick = () => {\n        const mapVal = getEl('edit-text').value;\n        const rows = mapVal.trim().split('\\n');\n\n        if (rows.length === 0) {\n          alert('Please enter a map to share');\n          return;\n        }\n\n        const tempCanvas = document.createElement('canvas');\n        const tmpCtx = tempCanvas.getContext('2d');\n        const size = 14;\n\n        tmpCtx.fillStyle = 'black';\n        tmpCtx.font = size + 'px monospace';\n        const bounds = tmpCtx.measureText(rows[0]);\n        tempCanvas.width = bounds.width;\n        tempCanvas.height = rows.length * size;\n        tmpCtx.font = size + 'px monospace';\n\n        rows.forEach((row, i) => {\n          tmpCtx.fillText(row, 0, i * size);\n        })\n        const thumbnail = tempCanvas.toDataURL();\n\n        console.log('THUMBY', tempCanvas.width, tempCanvas.height, thumbnail);\n\n        OL.user.share('widget', {\n          thumbnail: thumbnail,\n          map: mapVal,\n          sprites: artStyles,\n          selectedStyle: selectedStyle\n        });\n      };\n    }\n\n    if (map) {\n      getEl('edit-text').value = map;\n    }\n\n    if (spriteSheets && spriteSheets.length > 0) {\n      artStyles = spriteSheets;\n    }\n  }\n\n  const artStylesSelect = getEl('theme');\n  artStyles.forEach((style, i) => {\n    const option = document.createElement('option');\n    option.text = style.name;\n    option.value = style.url;\n    artStylesSelect.appendChild(option);\n  });\n\n  if (OL && OL.mode === 'display') {\n    const customOption = document.createElement('option');\n    customOption.text = 'Custom: Upload your own';\n    customOption.value = 'CUSTOM';\n    artStylesSelect.appendChild(customOption);\n\n    const uploadButton = getEl('theme-save');\n    uploadButton.onclick = () => {\n      const file = getEl('theme-file').files[0];\n\n      if (file) {\n        uploadButton.dataset.loading = 'true';\n        OL.files.create('sprites.png', function(response) {\n          var storageKey = response.storageKey;\n          var uploadURL  = response.uploadURL;\n          uploadFile(file, uploadURL, () => {\n            OL.files.getURLs([storageKey], (urls) => {\n              uploadButton.dataset.loading = 'false';\n              const newStyle = {\n                name: getEl('theme-name').value,\n                url: urls[0]\n              };\n              artStyles.unshift(newStyle);\n              const newOption = document.createElement('option');\n              newOption.text = newStyle.name;\n              newOption.value = newStyle.url;\n              artStylesSelect.insertBefore(newOption, artStylesSelect.firstChild);\n              artStylesSelect.value = newStyle.url;\n              selectedStyle = 0;\n              getEl('theme-upload').style.display = 'none';\n            });\n          });\n        });\n      }\n    };\n  }\n\n  artStylesSelect.onchange = (evt) => {\n    const selected = evt.target;\n    if (selected.selectedIndex >= artStyles.length) {\n      getEl('theme-upload').style.display = '';\n      getEl('theme-name').value = '';\n    } else {\n      getEl('theme-upload').style.display = 'none';\n      selectedStyle = selected.selectedIndex;\n    }\n  };\n\n  artStylesSelect.value = artStyles[selectedStyle].url;\n\n\n  let isEditorOpen = false;\n\n  let gameState = getEl('edit-text').value;\n\n  const canvas = getEl('gameCanvas');\n  let spriteSheet = artStyles[selectedStyle].url;\n  let log = '';\n  const updateLog = () => {\n    const logDisplay = getEl('log');\n    logDisplay.innerText = log.trim();\n    logDisplay.scrollTop = logDisplay.scrollHeight;\n  };\n\n  const onChange = (grid, inventory, visited, isGameOver, message, windowStr) => {\n    getEl('agent-window').innerText = windowStr;\n\n    const inventoryItems = [\n      {\n        id: 'key',\n        symbol: InventoryTypes.Key\n      },\n      {\n        id: 'stone',\n        symbol: InventoryTypes.Stone\n      },\n      {\n        id: 'axe',\n        symbol: InventoryTypes.Axe\n      },\n      {\n        id: 'gold',\n        symbol: InventoryTypes.Gold\n      },\n      {\n        id: 'raft',\n        symbol: InventoryTypes.Raft\n      },\n      {\n        id: 'dynamite',\n        symbol: InventoryTypes.Dynamite\n      },\n    ];\n\n    inventoryItems.forEach((item) => {\n      const element = getEl(item.id);\n      let count = 0;\n      inventory.forEach(inventoryItem => {\n        if (inventoryItem === item.symbol) {\n          count++;\n        }\n      });\n\n      if (count > 0) {\n        element.style.display = '';\n        if (count > 1) {\n          element.innerText = count;\n        } else {\n          element.innerText = '';\n        }\n      } else {\n        element.style.display = 'none';\n      }\n    });\n\n    if (message || isGameOver) {\n      log += message + '\\n';\n      if (isGameOver) {\n        log += 'Game Over.\\n\\n';\n      }\n\n      updateLog();\n    }\n  };\n\n  const game = new RogueGame(canvas, gameState, spriteSheet, onChange);\n  const gridWorld = game.gridWorld;\n\n  const initIcons = () => {\n    const inventoryIcons = Array.from(getEl('inventory').getElementsByTagName(\"LI\"));\n    const iconPositions = {\n      axe: [0, 0],\n      key: [2, 2],\n      dynamite: [6, 0],\n      raft: [3, 3],\n      gold: [7, 0]\n    };\n    inventoryIcons.forEach(icon => {\n      const pos = iconPositions[icon.id];\n      if (pos) {\n        icon.style.backgroundImage = `url(\"${spriteSheet}\")`;\n        icon.style.backgroundPosition = `${-pos[0] * 64}px ${-pos[1] * 64}px`;\n      }\n    });\n  };\n  initIcons();\n\n  const actionButtons = {\n    l: getEl('action-l'),\n    r: getEl('action-r'),\n    f: getEl('action-f'),\n    c: getEl('action-c'),\n    u: getEl('action-u'),\n    b: getEl('action-b')\n  };\n\n  const actionHandler = (action) => (e) => game.performAction(action);\n\n  Object.keys(actionButtons).forEach((key) => {\n    actionButtons[key].onclick = actionHandler(key);\n  });\n\n  window.onblur = () => gridWorld.stop();\n  window.onfocus = () => gridWorld.run();\n  window.onresize = () => gridWorld.hasModified = true;\n  window.onkeydown = (e) => {\n    if (isEditorOpen) return;\n\n    const speed = 8;\n    switch (e.keyCode) {\n      case 38: gridWorld.pan(0, -speed); break;\n      case 40: gridWorld.pan(0,  speed); break;\n      case 37: gridWorld.pan(-speed, 0); break;\n      case 39: gridWorld.pan(speed,  0); break;\n      case 'L'.charCodeAt(0): game.performAction('l'); break;\n      case 'R'.charCodeAt(0): game.performAction('r'); break;\n      case 'F'.charCodeAt(0): game.performAction('f'); break;\n      case 'C'.charCodeAt(0): game.performAction('c'); break;\n      case 'U'.charCodeAt(0): game.performAction('u'); break;\n      case 'B'.charCodeAt(0): game.performAction('b'); break;\n\n      case 'A'.charCodeAt(0): game.performAction('l'); break;\n      case 'D'.charCodeAt(0): game.performAction('r'); break;\n      case 'W'.charCodeAt(0): game.performAction('f'); break;\n      case 'Q'.charCodeAt(0): game.performAction('c'); break;\n      case 'E'.charCodeAt(0): game.performAction('u'); break;\n      case 'S'.charCodeAt(0): game.performAction('b'); break;\n\n      case '0'.charCodeAt(0): game.revealMap(); break;\n      default: break;\n    }\n  }\n\n  let dragStart = null;\n  canvas.onmousedown = (e) => {\n    const rect = canvas.getBoundingClientRect();\n    dragStart = {\n      x: e.clientX - rect.left,\n      y: e.clientY - rect.top,\n      rect: rect\n    };\n    gridWorld.startDrag(dragStart.x, dragStart.y);\n  };\n  window.onmouseup = (e) => {\n    dragStart = null;\n  };\n  window.onmousemove = (e) => {\n    if (dragStart) {\n      gridWorld.moveDrag(\n        e.clientX - dragStart.rect.left,\n        e.clientY - dragStart.rect.top\n      );\n    }\n  };\n\n  const closeEditor = () => {\n    getEl('editor').style.display = 'none';\n    isEditorOpen = false;\n  };\n  const openEditor = () => {\n    if (OL) OL.user.logInteraction();\n    getEl('editor').style.display = '';\n    isEditorOpen = true;\n  };\n\n  getEl('close-editor').onclick = closeEditor;\n  getEl('edit').onclick = openEditor;\n\n  const loadMap = () => {\n    gameState = getEl('edit-text').value;\n    const theme = getEl('theme').value;\n\n    if (theme === 'CUSTOM') {\n      alert(\"No theme uploaded.\");\n    } else {\n      try {\n        spriteSheet = theme;\n        gridWorld.changeSprites(theme);\n        initIcons();\n        game.loadState(gameState, [], []);\n        getEl('editor').style.display = 'none';\n        isEditorOpen = false;\n      } catch (err) {\n        //throw err;\n        alert(err);\n      }\n    }\n  };\n\n  getEl('editor-save').onclick = loadMap;\n\n  getEl('reset').onclick = () => {\n    log = 'Reset.\\n';\n    updateLog();\n    try {\n      game.loadState(gameState, [], []);\n    } catch (err) {\n      alert(err);\n    }\n  };\n\n  gridWorld.run();\n};\n\n\nwindow.onload = () => {\n  if (OL) {\n    OL(init);\n  } else {\n    init();\n  }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./index.js\n\n\n// WEBPACK FOOTER //\n// ./index.js","import GridWorld from './GridWorld.js';\nimport RuleSet from './RuleSet.js';\nimport {TileTypes, FeatureTypes, InventoryTypes, PlayerChars, PlayerDirections} from './Constants.js';\n\nclass Tile {\n  constructor(symbol, orientation = null) {\n    const symbolMap = {\n      'T': [TileTypes.Ground, FeatureTypes.Tree],\n      't': [TileTypes.Ground, FeatureTypes.Stump], // extra, shimmed in\n      'a': [TileTypes.Ground, FeatureTypes.Axe],\n      'k': [TileTypes.Ground, FeatureTypes.Key],\n      // 'o': [TileTypes.Ground, FeatureTypes.Stone],\n      '$': [TileTypes.Ground, FeatureTypes.Gold],\n      'x': [TileTypes.Ground, FeatureTypes.Start], // extra, shimmed in\n      ' ': [TileTypes.Ground, FeatureTypes.Empty],\n      '-': [TileTypes.Wall,   FeatureTypes.Door],\n      '!': [TileTypes.Wall,   FeatureTypes.DoorOpen], // extra, shimmed in\n      '*': [TileTypes.Wall,   FeatureTypes.Wall],\n      '~': [TileTypes.Water,  FeatureTypes.Empty],\n      // 'O': [TileTypes.Water,  FeatureTypes.Stone],\n      'd': [TileTypes.Ground, FeatureTypes.Dynamite],\n      'w': [TileTypes.Ground, FeatureTypes.Wilson], // ???\n      'D': [TileTypes.Ground, FeatureTypes.Exploded] // extra, shimmed in\n    };\n\n    const [tile, feature] = symbolMap[symbol];\n\n    this.tile = tile;\n    this.feature = feature;\n    this.orientation = orientation;\n  }\n\n  getLinkingType() {\n    if (this.orientation === null) return null;\n\n    const {linkN, linkS, linkE, linkW} = this.orientation;\n    const [n, s, e, w] = [linkN, linkS, linkE, linkW];\n\n    // Name for every linking type, as a combination of N/S/E/W\n    const tileCondition = {\n      X:  n &&  s &&  e &&  w,\n\n      WX: n &&  s &&  e && !w,\n      EX: n &&  s && !e &&  w,\n      SX: n && !s &&  e &&  w,\n      NX:!n &&  s &&  e &&  w,\n\n      NW:!n &&  s &&  e && !w,\n      NE:!n &&  s && !e &&  w,\n      SW: n && !s &&  e && !w,\n      SE: n && !s && !e &&  w,\n\n      NS: n &&  s && !e && !w,\n      EW:!n && !s &&  e &&  w,\n\n      S:  n && !s && !e && !w,\n      N: !n &&  s && !e && !w,\n      W: !n && !s &&  e && !w,\n      E: !n && !s && !e &&  w,\n\n      A: !n && !s && !e && !w\n    };\n\n    return Object.keys(tileCondition).filter((key) => tileCondition[key])[0];\n  }\n\n  getBoundingType(isGround=false) {\n    if (this.orientation === null) return null;\n\n    const {\n      waterN, waterS, waterE, waterW,\n      groundN, groundS, groundE, groundW\n    } = this.orientation;\n\n    const [n, s, e, w] = isGround ?\n      [groundN, groundS, groundE, groundW] :\n      [waterN, waterS, waterE, waterW];\n\n    // Name for every bounding type, as a combination of N/S/E/W\n    const tileCondition = {\n      NW:!n &&  s &&  e && !w,\n      NE:!n &&  s && !e &&  w,\n      SW: n && !s &&  e && !w,\n      SE: n && !s && !e &&  w,\n\n      SU:  n && !s && !e && !w,\n      NU: !n &&  s && !e && !w,\n      WU: !n && !s &&  e && !w,\n      EU: !n && !s && !e &&  w,\n\n      O: !n && !s && !e && !w\n    };\n\n    const result = Object.keys(tileCondition).filter((key) => tileCondition[key]);\n\n    if (result.length === 1) {\n      return result[0];\n    } else {\n      return null;\n    }\n  }\n\n  getLayer(layer) {\n    let prefix = null;\n    let key = null;\n\n    if (layer === 0) {\n      if (this.tile === TileTypes.Water) {\n        key = Symbol.keyFor(TileTypes.Water);\n      } else {\n        key = Symbol.keyFor(TileTypes.Ground);\n      }\n\n      const bounding = this.getBoundingType(this.tile !== TileTypes.Water);\n      if (bounding) {\n        key = bounding + '-' + key;\n      }\n    } else if (layer === 1 && this.tile !== TileTypes.Wall) {\n      key = Symbol.keyFor(this.tile);\n\n      if (this.feature === FeatureTypes.Empty) {\n        prefix = null;\n      } else {\n        prefix = Symbol.keyFor(this.feature);\n      }\n\n      if (key !== null && prefix !== null) {\n        key = prefix + '-' + key;\n      } else {\n        key = null;\n      }\n    } else if (layer === 2 && this.tile === TileTypes.Wall) {\n      let linking = this.getLinkingType();\n      if (this.feature === FeatureTypes.Door || this.feature === FeatureTypes.DoorOpen) {\n        if (['S', 'N', 'SX', 'NX', 'NS'].includes(linking)) {\n          linking = 'NS';\n        } else {\n          linking = 'EW';\n        }\n      }\n      key = linking + '-' + Symbol.keyFor(this.feature);\n    }\n\n    return key;\n  }\n}\n\nexport default class RogueGame {\n  constructor(canvas, stateString, spriteSheet, onChange) {\n    this.canvas = canvas;\n    this.onChange = onChange;\n    this.startingState = null;\n    this.loadState(stateString);\n    const layers = this.createLayers(this.grid);\n    const [width, height] = [this.grid.width, this.grid.height];\n\n    this.gridWorld = new GridWorld(this.canvas, {\n      \"width\": width,\n      \"height\": height,\n      \"size\": 64,\n      \"pan\": [width / 2, height / 2],\n      \"grid\": layers,\n      \"spritesheet\": spriteSheet,\n      \"sprites\": {\n        \"Axe-Ground\":      {sheet: {x: 0, y: 0}},\n        \"Exploded-Ground\": {sheet: {x: 1, y: 0}},\n        \"EW-Door\":         {sheet: {x: 2, y: 0}},\n        \"NS-Door\":         {sheet: {x: 3, y: 0}},\n        \"EW-DoorOpen\":     {sheet: {x: 4, y: 0}},\n        \"NS-DoorOpen\":     {sheet: {x: 5, y: 0}},\n        \"Dynamite-Ground\": {sheet: {x: 6, y: 0}},\n        \"Gold-Ground\":     {sheet: {x: 7, y: 0}},\n\n        \"EU-Ground\": {sheet: {x: 0, y: 1}},\n        \"NE-Ground\": {sheet: {x: 1, y: 1}},\n        \"NU-Ground\": {sheet: {x: 2, y: 1}},\n        \"NW-Ground\": {sheet: {x: 3, y: 1}},\n        \"O-Ground\":  {sheet: {x: 4, y: 1}},\n        \"SE-Ground\": {sheet: {x: 5, y: 1}},\n        \"SU-Ground\": {sheet: {x: 6, y: 1}},\n        \"SW-Ground\": {sheet: {x: 7, y: 1}},\n\n        \"WU-Ground\":  {sheet: {x: 0, y: 2}},\n        \"Ground\":     {sheet: {x: 1, y: 2}},\n        \"Key-Ground\": {sheet: {x: 2, y: 2}},\n\n        \"a>\": {sheet: {x: 3, y: 2}},\n        \"a^\": {sheet: {x: 4, y: 2}},\n        \"av\": {sheet: {x: 5, y: 2}},\n        \"a<\": {sheet: {x: 6, y: 2}},\n        \">\":  {sheet: {x: 7, y: 2}},\n        \"^\":  {sheet: {x: 0, y: 3}},\n        \"v\":  {sheet: {x: 1, y: 3}},\n        \"<\":  {sheet: {x: 2, y: 3}},\n\n        \"Raft\": {sheet: {x: 3, y: 3}},\n\n        \"Start-Ground\": {sheet: {x: 4, y: 3}},\n        \"Stump-Ground\": {sheet: {x: 5, y: 3}},\n        \"Tree-Ground\":  {sheet: {x: 6, y: 3}},\n\n        \"A-Wall\": {sheet: {x: 7, y: 3}},\n\n        \"E-Wall\":  {sheet: {x: 0, y: 4}},\n        \"EW-Wall\": {sheet: {x: 1, y: 4}},\n        \"EX-Wall\": {sheet: {x: 2, y: 4}},\n\n        \"N-Wall\":  {sheet: {x: 3, y: 4}},\n        \"NE-Wall\": {sheet: {x: 4, y: 4}},\n        \"NS-Wall\": {sheet: {x: 5, y: 4}},\n        \"NW-Wall\": {sheet: {x: 6, y: 4}},\n        \"NX-Wall\": {sheet: {x: 7, y: 4}},\n\n        \"S-Wall\":  {sheet: {x: 0, y: 5}},\n        \"SE-Wall\": {sheet: {x: 1, y: 5}},\n        \"SW-Wall\": {sheet: {x: 2, y: 5}},\n        \"SX-Wall\": {sheet: {x: 3, y: 5}},\n\n        \"W-Wall\":  {sheet: {x: 4, y: 5}},\n        \"WX-Wall\": {sheet: {x: 5, y: 5}},\n        \"X-Wall\":  {sheet: {x: 6, y: 5}},\n\n        \"EU-Water\": {sheet: {x: 7, y: 5}},\n        \"NE-Water\": {sheet: {x: 0, y: 6}},\n        \"NU-Water\": {sheet: {x: 1, y: 6}},\n        \"NW-Water\": {sheet: {x: 2, y: 6}},\n        \"O-Water\":  {sheet: {x: 3, y: 6}},\n        \"SE-Water\": {sheet: {x: 4, y: 6}},\n        \"SU-Water\": {sheet: {x: 5, y: 6}},\n        \"SW-Water\": {sheet: {x: 6, y: 6}},\n        \"WU-Water\": {sheet: {x: 7, y: 6}},\n        \"Water\": {sheet: {x: 0, y: 7}},\n        \"Wilson-Ground\": {sheet: {x: 1, y: 7}},\n\n        \"Unseen\": {fill: 'rgba(0, 0, 0, 0.4)', stroke: 'rgba(96, 96, 96, 0.8)'},\n        \"Unvisited\": {fill: 'rgba(0, 0, 0, 0.8)', stroke: 'rgba(32, 32, 32, 0.8)'}\n      }\n    });\n  }\n\n  loadState(stateString, visited=null, inventory=null, explosions=null, isStartingState=true) {\n    this.explosions = [];\n\n    if (explosions) {\n      this.explosions = explosions;\n    }\n\n    if (isStartingState) {\n      this.startingState = null;\n    }\n\n    try {\n      this.grid = this.parse(stateString);\n    } catch (err) {\n      throw \"Unable to parse the map.\";\n    }\n\n    this.isGameOver = false;\n    this.isWin = false;\n    this.visited = Array(this.grid.width * this.grid.height).fill('Unvisited');\n\n    if (inventory) {\n      this.inventory = inventory;\n    }\n\n    if (!this.inventory) {\n      this.inventory = [];\n    }\n\n    if (visited) {\n      visited.forEach((value, index) => this.visited[index] = null);\n    }\n\n    if (!this.ruleset) {\n      this.ruleset = new RuleSet(this.grid, this.inventory, this.explosions);\n    } else {\n      this.ruleset.setState(this.grid, this.inventory, this.explosions);\n    }\n\n    this.update('Map Loaded.');\n  }\n\n  getVisited() {\n    const visited = [];\n    this.visited.forEach((value, index) => {\n      if (value === null) visited.push(index);\n    });\n    return visited;\n  }\n\n  performAction(action) {\n    if (this.isGameOver || this.isWin) return;\n\n    let message;\n\n    try {\n      message = this.ruleset.perform(action);\n      if (message === true) {\n        this.isWin = true;\n      }\n    } catch (err) {\n      if (err.type === 'dead') {\n        if (err.reason === 'drowned') {\n          message = 'Agent fell into water and drowned';\n        } else if (err.reason === 'outside') {\n          message = 'Agent wandered off and got lost in the wilderness';\n        } else {\n          message = 'Agent died... somehow';\n        }\n\n        this.isGameOver = true;\n      } else {\n        throw err;\n      }\n    }\n\n    if (message === true) {\n      message = 'Gold has been collected.\\nMission successful!\\n';\n    }\n\n    this.update(action.toUpperCase() + ': ' + message);\n  }\n\n  update(message) {\n    this.updateVisited(this.grid);\n\n    if (this.gridWorld) {\n      const layers = this.createLayers(this.grid);\n      const [width, height] = [this.grid.width, this.grid.height];\n\n      this.gridWorld.changeLayers(layers, width, height);\n      this.gridWorld.hasModified = true;\n    }\n\n    if (this.onChange) {\n      this.onChange(this.grid, this.inventory, this.visited, this.isGameOver || this.isWin, message, this.getWindow());\n    }\n  }\n\n  updateVisited(grid) {\n    const py = Math.floor(grid.player.index / grid.width);\n    const px = (grid.player.index % grid.width);\n    for (let y = py - 2; y <= py + 2; y++) {\n      for (let x = px - 2; x <= px + 2; x++) {\n        if (this.inBounds(x, y, grid)) {\n          this.visited[y * grid.width + x] = null;\n        }\n      }\n    }\n  }\n\n  fillExtraFeatures(cell, i) {\n    // infer hidden or unspecified features\n    const startCell = this.startingState[i];\n\n    if (PlayerChars.includes(cell)) {\n      // infer what cell the player is standing on\n      if (startCell === '~') {\n        // in the water\n        cell = 'O'; // player must be standing on a stone\n      } else if (startCell === '-') {\n        // in a doorway\n        cell = '-'; // player must be standing in a doorway\n      } else {\n        cell = ' '; // player must be standing on the ground\n      }\n    }\n\n    if (cell === ' ') {\n      if (startCell === 'T') {\n        // This was a tree when we started\n        cell = 't'; // now a stump\n      } else if (startCell === '-') {\n        // This was a doorway\n        cell = '!'; // now an open door\n      } else if (PlayerChars.includes(startCell)) {\n        // This is where the player started\n        cell = 'x'; // mark starting location\n      }\n    }\n\n    if (this.explosions.includes(cell)) {\n      cell = 'D';\n    }\n\n    return cell;\n  }\n\n  findPlayer(mapData) {\n    const player = {\n      index: null,\n      orientation: null\n    };\n\n    mapData.forEach((cell, i) => {\n      const orientation = PlayerChars.indexOf(cell);\n      if (orientation >= 0) {\n        player.index = i;\n        player.orientation = orientation;\n      }\n    });\n\n    return player;\n  }\n\n  calculateOrientation(cell, i, mapData, width, height) {\n    const wallFeatures = ['-', '!', '*'];\n    let orientation = {};\n\n    const featurePresent = (x, y, features, notFeatures) => {\n      if ((x >= 0 && x < width) && (y >= 0 && y < height)) {\n        if (features) {\n          return features.includes(mapData[y * width + x]);\n        } else {\n          return !notFeatures.includes(mapData[y * width + x]);\n        }\n      } else {\n        if (!features || features.includes('~')) {\n          return true;\n        } else {\n          return false;\n        }\n      }\n    }\n\n    const y = Math.floor(i / width);\n    const x = (i % width);\n\n    if (wallFeatures.includes(cell)) {\n      Object.assign(orientation, {\n        linkN: featurePresent(x, y - 1, wallFeatures),\n        linkS: featurePresent(x, y + 1, wallFeatures),\n        linkE: featurePresent(x + 1, y, wallFeatures),\n        linkW: featurePresent(x - 1, y, wallFeatures)\n      });\n    }\n\n    if (cell === '~') {\n      Object.assign(orientation, {\n        waterN: featurePresent(x, y - 1, ['~']),\n        waterS: featurePresent(x, y + 1, ['~']),\n        waterE: featurePresent(x + 1, y, ['~']),\n        waterW: featurePresent(x - 1, y, ['~'])\n      });\n    } else {\n      Object.assign(orientation, {\n        groundN: featurePresent(x, y - 1, null, ['~']),\n        groundS: featurePresent(x, y + 1, null, ['~']),\n        groundE: featurePresent(x + 1, y, null, ['~']),\n        groundW: featurePresent(x - 1, y, null, ['~'])\n      });\n    }\n\n    return orientation;\n  }\n\n  inBounds(x, y, grid) {\n    const [width, height] = [grid.width, grid.height];\n    return (x >= 0 && x < width) && (y >= 0 && y < height);\n  }\n\n  createLayers(grid) {\n    const backgroundLayer = grid.tiles.map(tile => tile.getLayer(0));\n    const foregroundLayer = grid.tiles.map(tile => tile.getLayer(1));\n    const wallLayer       = grid.tiles.map(tile => tile.getLayer(2));\n    const extrasLayer     = Array(grid.width * grid.height).fill(null);\n    const playerLayer     = Array(grid.width * grid.height).fill(null);\n    const visibleLayer    = Array(grid.width * grid.height).fill('Unseen');\n    const visitedLayer    = this.visited;\n\n    if (!this.isGameOver) {\n\n      if (this.inventory.includes(InventoryTypes.Axe)) {\n        playerLayer[grid.player.index] = 'a' + PlayerChars[grid.player.orientation];\n      } else {\n        playerLayer[grid.player.index] = PlayerChars[grid.player.orientation];\n      }\n      if (\n        this.inventory.includes(InventoryTypes.Raft) &&\n        grid.tiles[grid.player.index].tile === TileTypes.Water\n      ) {\n        extrasLayer[grid.player.index] = 'Raft';\n      }\n    }\n\n    const py = Math.floor(grid.player.index / grid.width);\n    const px = (grid.player.index % grid.width);\n    for (let y = py - 2; y <= py + 2; y++) {\n      for (let x = px - 2; x <= px + 2; x++) {\n        if (this.inBounds(x, y, grid)) {\n          visibleLayer[y * grid.width + x] = null;\n        }\n      }\n    }\n\n    return [backgroundLayer, foregroundLayer, wallLayer, extrasLayer, playerLayer, visibleLayer, visitedLayer, null];\n  }\n\n  revealMap() {\n    this.visited = Array(this.grid.width * this.grid.height).fill(null);\n    this.update('Revealed Map');\n  }\n\n  getWindow() {\n    const grid = this.grid;\n    const py = Math.floor(grid.player.index / grid.width);\n    const px = (grid.player.index % grid.width);\n    const size = 5;\n    let windStr = '';\n\n    const tileToChar = (x, y) => {\n      const tile = grid.tiles[y * grid.width + x];\n      if (tile.tile === TileTypes.Ground) {\n        switch (tile.feature) {\n          case FeatureTypes.Tree:  return 'T';\n          case FeatureTypes.Axe:   return 'a';\n          case FeatureTypes.Key:   return 'k';\n          case FeatureTypes.Stone: return 'o';\n          case FeatureTypes.Gold:  return 'g';\n          case FeatureTypes.Dynamite: return 'd';\n          case FeatureTypes.Wilson: return '?';\n          default: return ' ';\n        }\n      } else if (tile.tile === TileTypes.Wall) {\n        switch (tile.feature) {\n          case FeatureTypes.Door:  return '-';\n          default: return '*';\n        }\n      } else if (tile.tile === TileTypes.Water) {\n        switch (tile.feature) {\n          case FeatureTypes.Stone: return 'O';\n          default: return '~';\n        }\n      }\n    };\n\n    for (let i = 0; i < size*size; ++i) {\n      if (i % size === 0 && i !== 0) {\n          windStr += '\\n';\n      }\n\n      const [wx, wy] = [i % size - 2, Math.floor(i / size) - 2];\n      let x, y;\n\n      switch (grid.player.orientation) {\n        case PlayerDirections.North: x = px + wx, y = py + wy; break;\n        case PlayerDirections.South: x = px - wx, y = py - wy; break;\n        case PlayerDirections.West : x = px + wy, y = py - wx; break;\n        case PlayerDirections.East : x = px - wy, y = py + wx; break;\n      }\n\n      if (this.inBounds(x, y, grid)) {\n        windStr += tileToChar(x, y);\n      } else {\n        windStr += '.';\n      }\n    }\n\n    return windStr;\n  }\n\n  parse(stateString) {\n    const rows   = stateString.split('\\n').filter(row => row.length > 0);\n    const height = rows.length;\n    const width  = rows[0].length;\n    const data   = [];\n\n    rows.forEach(row => {\n      if (row.length === width) {\n        row.split('').forEach(cell => data.push(cell));\n      } else {\n        throw \"Incorrect width\";\n      }\n    });\n\n    if (!this.startingState) {\n      this.startingState = data.slice();\n    }\n\n    const tiles = data.map((cell, i) => {\n      cell = this.fillExtraFeatures(cell, i);\n      const orientation = this.calculateOrientation(cell, i, data, width, height);\n      return new Tile(cell, orientation);\n    });\n\n    const player = this.findPlayer(data);\n\n    return {\n      width: width,\n      height: height,\n      tiles: tiles,\n      player: player\n    };\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./RogueGame.js\n\n\n// WEBPACK FOOTER //\n// ./RogueGame.js","import Game from './Game.js';\n\nconst NORTH = 0;\nconst SOUTH = 1;\nconst EAST = 2;\nconst WEST = 3;\n\nexport default class GridWorld extends Game {\n  /*\n    initData = {\n      \"width\": 2,\n      \"height\": 2,\n      \"size\": 64,\n      \"pan\": [1, 1],\n      \"grid\": [\n        \"a\", null,\n        null, \"b\"\n      ],\n      \"sprites\": {\n        \"a\": \"https://www.example.com/a.png\",\n        \"b\": [\n          \"https://www.example.com/b1.png\",\n          \"https://www.example.com/b2.png\",\n          \"https://www.example.com/b3.png\",\n          \"https://www.example.com/b4.png\"\n        ]\n      }\n    }\n  */\n  constructor(canvas, initData) {\n    super(canvas);\n    this.gridWidth = initData.width;\n    this.gridHeight = initData.height;\n    this.gridSize = initData.size;\n    this.background = initData.background || [];\n    this.grid = initData.grid || [[]];\n    for (const layer of this.grid) {\n      if (layer) {\n        layer.length = this.gridWidth * this.gridHeight;\n      }\n    }\n    this.gridPan = initData.pan || [Math.floor(gridWidth/2), Math.floor(gridHeight/2)];\n    this.loadSprites(initData.sprites, initData.spritesheet)\n    this.hasModified = true;\n  }\n\n  changeLayers(layers=this.grid, width=this.gridWidth, height=this.gridHeight, size=this.gridSize) {\n    this.grid = layers;\n    this.gridWidth = width;\n    this.gridHeight = height;\n    this.gridSize = size;\n  }\n\n  changeSprites(spriteSheetUrl) {\n    if (spriteSheetUrl) {\n      if (this.spritesheet && spriteSheetUrl === this.spritesheet.src) {\n        return;\n      }\n      this.spritesheet = new Image();\n      this.spritesheet.src = spriteSheetUrl;\n      this.spritesheet.onload = () => this.hasModified = true;\n    }\n  }\n\n  loadSprites(sprites, spritesheet) {\n    this.sprites = sprites || {};\n    Object.keys(this.sprites).forEach(key => {\n      if (typeof this.sprites[key] === 'string') {\n        const image = new Image();\n        image.src = this.sprites[key];\n        image.onload = () => this.hasModified = true;\n        this.sprites[key] = image;\n      }\n    });\n\n    this.changeSprites(spritesheet)\n  }\n\n  update(dt) {\n    return this.hasModified;\n  }\n\n  lookup(x, y) {\n    return this.grid[y * this.gridWidth + x];\n  }\n\n  startDrag(x, y) {\n    this.drag = {\n      x: x,\n      y: y,\n      pan: {\n        x: this.gridPan[0],\n        y: this.gridPan[1]\n      }\n    };\n  }\n\n  moveDrag(x, y) {\n    if (!this.drag) return;\n\n    const gridDx = -(x - this.drag.x)/this.gridSize;\n    const gridDy = -(y - this.drag.y)/this.gridSize;\n\n    this.gridPan[0] = this.drag.pan.x + gridDx;\n    this.gridPan[1] = this.drag.pan.y + gridDy;\n    this.hasModified = true;\n  }\n\n  endDrag(x, y) {\n    this.drag = null;\n  }\n\n  getPan() {\n    return {\n      x: this.gridPan[0] * this.gridSize,\n      y: this.gridPan[1] * this.gridSize\n    }\n  }\n\n  pan(dx, dy) {\n    this.gridPan[0] -= dx/this.gridSize;\n    this.gridPan[1] -= dy/this.gridSize;\n    this.hasModified = true;\n  }\n\n  panTo(x, y) {\n    this.gridPan[0] = x/this.gridSize;\n    this.gridPan[1] = y/this.gridSize;\n  }\n\n  drawLayer(layer) {\n    const ctx = this.context;\n    const scale = this.gridSize;\n    const offsetX = this.width /2 - this.gridPan[0] * scale;\n    const offsetY = this.height/2 - this.gridPan[1] * scale;\n\n    let x, y;\n    let textWidth, sprite;\n\n    ctx.font = `${scale/2}px sans-serif`;\n    ctx.imageSmoothingEnabled= false;\n\n    let gridI = 0;\n    while (gridI < this.gridWidth * this.gridHeight) {\n      y = offsetY + scale * Math.floor(gridI / this.gridWidth);\n      x = offsetX + scale * (gridI % this.gridWidth);\n\n      if (x < -scale || x > this.width + scale || y < -scale || y > this.height + scale) {\n        gridI++;\n        continue;\n      }\n\n      if (!layer) {\n        ctx.strokeStyle = '#666';\n        ctx.strokeRect(x, y, scale, scale);\n      } else if (layer[gridI]) {\n        sprite = this.sprites[layer[gridI]];\n\n        if (sprite && sprite.complete && sprite instanceof Image) {\n          ctx.drawImage(sprite,\n            0, 0, scale, scale,\n            x, y, scale, scale\n          );\n        } else if (sprite) {\n          if (sprite.fill) {\n            ctx.fillStyle = sprite.fill;\n            ctx.fillRect(x, y, scale, scale);\n          }\n          if (sprite.stroke) {\n            ctx.strokeStyle = sprite.stroke;\n            ctx.strokeRect(x, y, scale, scale);\n          }\n          if (sprite.sheet) {\n            ctx.drawImage(this.spritesheet,\n              sprite.sheet.x * scale, sprite.sheet.y * scale, scale, scale,\n              x, y, scale, scale\n            );\n          }\n        } else {\n          textWidth = ctx.measureText(layer[gridI]).width;\n          ctx.fillText(layer[gridI], x + scale/2 - textWidth/2, y + 5*scale/8);\n        }\n      }\n\n      gridI++;\n    }\n  }\n\n  draw() {\n    const ctx = this.context;\n\n    ctx.clearRect(0, 0, this.width, this.height);\n\n    let layer;\n    for (layer of this.grid) {\n      this.drawLayer(layer)\n    }\n\n    this.hasModified = false;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./GridWorld.js\n\n\n// WEBPACK FOOTER //\n// ./GridWorld.js","const requestAnimationFrame = window.requestAnimationFrame ||\n  window.webkitRequestAnimationFrame ||\n  window.mozRequestAnimationFrame ||\n  window.oRequestAnimationFrame ||\n  window.msRequestAnimationFrame ||\n  (callback => window.setTimeout(callback, 1000 / 60))\n;\n\nconst cancelAnimationFrame = window.cancelAnimationFrame ||\n  window.webkitCancelAnimationFrame ||\n  window.mozCancelAnimationFrame ||\n  window.oCancelAnimationFrame ||\n  window.msCancelAnimationFrame ||\n  window.clearTimeout\n;\n\nexport default class Game {\n  constructor(canvas) {\n    if (new.target === Game) {\n      throw new TypeError(\"Cannot construct an abstract class\");\n    }\n\n    if (typeof canvas === 'string') {\n      this.canvas = document.getElementById(canvas);\n      if (!this.canvas) throw new Error(`Unable to find element with ID: ${canvas}`);\n    } else {\n      this.canvas = canvas;\n    }\n\n    this.canvas.style.position = \"absolute\";\n    this.canvas.style.top = \"0\";\n    this.canvas.style.left = \"0\";\n    this.context = this.canvas.getContext('2d');\n\n    window.onresize = (e) => {\n      this.canvas.width = window.innerWidth\n      this.canvas.height = Math.max(window.innerHeight, 600);\n      this.width = this.canvas.width\n      this.height = this.canvas.height\n    };\n    window.onresize();\n\n    this.running = false;\n    this.frameRequest = null;\n  }\n\n  update(dt) {\n    throw new TypeError(\"Not Implemented: update method is required\");\n  }\n\n  draw() {\n    throw new TypeError(\"Not Implemented: draw method is required\");\n  }\n\n  run() {\n    if (this.running) return;\n\n    this.running = true;\n    const processFrame = () => {\n      this.step();\n      this.frameRequest = requestAnimationFrame(processFrame);\n    };\n\n    this.lastStep = Date.now();\n    this.frameRequest = requestAnimationFrame(processFrame);\n  }\n\n  stop() {\n    if (this.frameRequest) cancelAnimationFrame(this.frameRequest);\n    this.frameRequest = null;\n    this.running = false;\n  }\n\n  step() {\n    const now = Date.now();\n    const dt = (now - this.lastStep) / 1000;\n    this.lastStep = now;\n    if (this.update(dt) !== false) {\n      this.draw();\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./Game.js\n\n\n// WEBPACK FOOTER //\n// ./Game.js","import {TileTypes, FeatureTypes, PlayerChars, InventoryTypes} from './Constants.js';\n\nconst PassableTerrain = [\n  FeatureTypes.Empty,\n  FeatureTypes.Stump,\n  FeatureTypes.Start,\n  FeatureTypes.Axe,\n  FeatureTypes.Key,\n  FeatureTypes.Dynamite,\n  FeatureTypes.Gold,\n  FeatureTypes.Exploded\n];\n\nexport default class RuleSet {\n  constructor(grid, inventory, explosions) {\n    this.setState(grid, inventory, explosions);\n  }\n\n  setState(grid, inventory, explosions) {\n    this.grid = grid;\n    this.inventory = inventory;\n    this.explosions = explosions;\n  }\n\n  iToCoord(i) {\n    const x = (i % this.grid.width);\n    const y = Math.floor(i / this.grid.width);\n\n    return [x, y];\n  }\n\n  coordToI(coord) {\n    const [x, y] = coord;\n\n    if (!this.inBounds(x, y)) {\n      return -1;\n    } else {\n      return y * this.grid.width + x;\n    }\n  }\n\n  inBounds(x, y) {\n    const [width, height] = [this.grid.width, this.grid.height];\n    return (x >= 0 && x < width) && (y >= 0 && y < height);\n  }\n\n  north(i) {\n    const [x, y] = this.iToCoord(i);\n    return this.coordToI([x, y-1]);\n  }\n\n  south(i) {\n    const [x, y] = this.iToCoord(i);\n    return this.coordToI([x, y+1]);\n  }\n\n  west(i) {\n    const [x, y] = this.iToCoord(i);\n    return this.coordToI([x-1, y]);\n  }\n\n  east(i) {\n    const [x, y] = this.iToCoord(i);\n    return this.coordToI([x+1, y]);\n  }\n\n  perform(action) {\n    let message = null;\n\n    action = action.toLowerCase();\n\n    const dir = this.grid.player.orientation;\n    const index = this.grid.player.index;\n    const facing = [\n      'north', 'east', 'south', 'west'\n    ][dir];\n    const inFront = this[facing](index);\n\n    const actions = {\n      r: () => {\n        this.grid.player.orientation = (dir + 1) % 4;\n        message = 'Turned right.';\n      },\n\n      l: () => {\n        this.grid.player.orientation = (dir === 0) ? 3 : (dir - 1);\n        message = 'Turned left.';\n      },\n\n      f: () => {\n        if (inFront < 0) {\n          throw {\n            type: 'dead',\n            reason: 'outside'\n          };\n        }\n\n        const oldLocation = this.grid.tiles[index];\n        const location = this.grid.tiles[inFront];\n        const tile = location.tile;\n        const feature = location.feature;\n\n        let canMove = false;\n\n        if (tile === TileTypes.Ground) {\n          // moving on ground\n          if (PassableTerrain.includes(feature)) {\n            canMove = true;\n          } else {\n            message = 'Blocked by: ' + Symbol.keyFor(feature);\n          }\n          if (feature === FeatureTypes.Start && this.inventory.includes(InventoryTypes.Gold)) {\n            message = true;\n            const inventoryAt = this.inventory.indexOf(InventoryTypes.Gold);\n            this.inventory.splice(inventoryAt, 1);\n          }\n          if (oldLocation.tile === TileTypes.Water && canMove) {\n            // moving from water to ground\n            message = 'Raft broke.';\n            const inventoryAt = this.inventory.indexOf(InventoryTypes.Raft);\n            this.inventory.splice(inventoryAt, 1);\n          }\n        } else if (tile === TileTypes.Wall) {\n          if (feature === FeatureTypes.DoorOpen) {\n            canMove = true;\n          } else if (feature === FeatureTypes.Wall) {\n            message = 'Walked into a wall.';\n          } else if (feature === FeatureTypes.Door) {\n            message = 'Door is locked.';\n          }\n          if (oldLocation.tile === TileTypes.Water && canMove) {\n            // moving from water to doorway\n            message = 'Raft broke.';\n            const inventoryAt = this.inventory.indexOf(InventoryTypes.Raft);\n            this.inventory.splice(inventoryAt, 1);\n          }\n        } else if (tile === TileTypes.Water) {\n          if (this.inventory.includes(InventoryTypes.Raft)) {\n            // if you have a raft you can move on water\n            canMove = true;\n          } else {\n            throw {\n              type: 'dead',\n              reason: 'drowned'\n            };\n          }\n        }\n\n        if (canMove) {\n          this.grid.player.index = inFront;\n\n          const pickups = [FeatureTypes.Key, FeatureTypes.Axe, FeatureTypes.Dynamite, FeatureTypes.Gold];\n\n          if (tile === TileTypes.Ground && pickups.includes(location.feature)) {\n            this.inventory.push(location.feature);\n            message = 'Picked up: ' + Symbol.keyFor(location.feature);\n            location.feature = FeatureTypes.Empty;\n          }\n\n          if (!message) {\n            message = 'Moved forward.';\n          }\n        }\n      },\n\n      c: () => {\n        const location = this.grid.tiles[inFront];\n        const feature = location.feature;\n\n        if (\n          this.inventory.includes(InventoryTypes.Axe) &&\n          inFront >= 0 &&\n          feature === FeatureTypes.Tree\n        ) {\n          // chop down the tree\n          location.feature = FeatureTypes.Stump;\n          if (this.inventory.includes(InventoryTypes.Raft)) {\n            message = 'Chopped down a tree. Already have a raft.';\n          } else {\n            this.inventory.push(InventoryTypes.Raft);\n            message = 'Chopped down a tree and made a raft.';\n          }\n        } else {\n          message = 'Unable to chop.';\n        }\n      },\n\n      u: () => {\n        const location = this.grid.tiles[inFront];\n        const feature = location.feature;\n\n        if (\n          this.inventory.includes(InventoryTypes.Key) &&\n          inFront >= 0 &&\n          feature === FeatureTypes.Door\n        ) {\n          // unlock the door\n          location.feature = FeatureTypes.DoorOpen;\n          message = 'Unlocked a door.';\n        } else {\n          message = 'Unable to unlock.';\n        }\n      },\n\n      b: () => {\n        const location = this.grid.tiles[inFront];\n\n        if (\n          this.inventory.includes(InventoryTypes.Dynamite) &&\n          inFront >= 0 &&\n          (\n            location.tile === TileTypes.Wall ||\n            location.feature === FeatureTypes.Tree\n          )\n        ) {\n          if (location.tile === TileTypes.Wall) {\n            message = 'Blasted wall.';\n          } else {\n            message = 'Blasted tree.';\n          }\n          location.tile = TileTypes.Ground;\n          location.feature = FeatureTypes.Exploded;\n          this.explosions.push(inFront);\n\n          // hack to make walls click together properly\n          const tileDirs = {\n            n: [this.north(inFront), 'linkS'],\n            s: [this.south(inFront), 'linkN'],\n            e: [this.east(inFront), 'linkW'],\n            w: [this.west(inFront), 'linkE']\n          };\n          Object.keys(tileDirs).forEach(key => {\n            const [index, link] = tileDirs[key];\n            const cell = this.grid.tiles[index];\n            if (index >= 0 && cell.tile === TileTypes.Wall) {\n              cell.orientation[link] = false;\n            }\n          });\n\n          const inventoryAt = this.inventory.indexOf(InventoryTypes.Dynamite);\n          this.inventory.splice(inventoryAt, 1);\n        } else {\n          if (!this.inventory.includes(InventoryTypes.Dynamite)) {\n            message = 'No dynamite.';\n          } else {\n            message = 'Nothing to blow up.';\n          }\n        }\n      }\n    };\n\n    const delegate = actions[action];\n\n    if (delegate) {\n      delegate();\n    }\n\n    return message;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./RuleSet.js\n\n\n// WEBPACK FOOTER //\n// ./RuleSet.js","// Base background tile types\nexport const TileTypes = {\n  Water: Symbol.for('Water'),\n  Ground: Symbol.for('Ground'),\n  Wall: Symbol.for('Wall')\n};\n\n// Features which may be on tiles\nexport const FeatureTypes = {\n  Empty: Symbol.for('Empty'),\n  Tree: Symbol.for('Tree'),\n  Stump: Symbol.for('Stump'), // extra, shimmed in (for aesthetics)\n  Start: Symbol.for('Start'), // extra, shimmed in (for aesthetics)\n  Wall: Symbol.for('Wall'),\n  Door: Symbol.for('Door'),\n  DoorOpen: Symbol.for('DoorOpen'), // extra, shimmed in (for aesthetics)\n  Stone: Symbol.for('Stone'),\n  Axe: Symbol.for('Axe'),\n  Key: Symbol.for('Key'),\n  Gold: Symbol.for('Gold'),\n  Dynamite: Symbol.for('Dynamite'),\n  Exploded: Symbol.for('Exploded'),\n  Wilson: Symbol.for('Wilson')\n};\n\nexport const PlayerChars = ['^', '>', 'v', '<'];\n\nexport const PlayerDirections = {\n  North: 0,\n  East: 1,\n  South: 2,\n  West: 3\n};\n\nexport const InventoryTypes = {\n  Stone: Symbol.for('Stone'),\n  Axe: Symbol.for('Axe'),\n  Key: Symbol.for('Key'),\n  Gold: Symbol.for('Gold'),\n  Raft: Symbol.for('Raft'),\n  Dynamite: Symbol.for('Dynamite')\n};\n\n\n\n// WEBPACK FOOTER //\n// ./Constants.js\n\n\n// WEBPACK FOOTER //\n// ./Constants.js"],"sourceRoot":""}