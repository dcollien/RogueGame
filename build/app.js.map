{"version":3,"sources":["webpack:///webpack/bootstrap 770f4efdc27577d5fe72?b645","webpack:///./index.js?2645","webpack:///./RogueGame.js?9b46","webpack:///./GridWorld.js?3bb4","webpack:///./Game.js?fe14","webpack:///./RuleSet.js?b516","webpack:///./Constants.js?7aaf"],"names":["OL","window","getEl","id","document","getElementById","uploadFile","file","url","onLoad","onError","xhr","XMLHttpRequest","onload","onerror","open","overrideMimeType","type","setRequestHeader","send","init","artStyles","selectedStyle","resize","on","onresize","map","spriteSheets","name","mode","exhibit","data","sprites","user","concat","shareButton","style","display","onclick","mapVal","value","rows","trim","split","length","alert","tempCanvas","createElement","tmpCtx","getContext","size","fillStyle","font","bounds","measureText","width","ySize","Math","floor","height","forEach","row","i","fillText","thumbnail","toDataURL","share","artStylesSelect","option","text","appendChild","customOption","uploadButton","files","dataset","loading","create","response","storageKey","uploadURL","getURLs","urls","newStyle","unshift","newOption","insertBefore","firstChild","onchange","evt","selected","target","selectedIndex","isEditorOpen","gameState","canvas","spriteSheet","log","updateLog","logDisplay","innerText","scrollTop","scrollHeight","onChange","grid","inventory","visited","isGameOver","message","windowStr","inventoryItems","symbol","Key","Stone","Axe","Gold","Raft","Dynamite","item","element","count","inventoryItem","game","gridWorld","initIcons","inventoryIcons","Array","from","getElementsByTagName","iconPositions","axe","key","dynamite","raft","gold","gridSize","gridWidth","media","matchMedia","pos","icon","matches","backgroundImage","backgroundSize","backgroundPosition","actionButtons","l","r","f","c","u","b","actionHandler","action","e","performAction","Object","keys","onblur","stop","onfocus","run","hasModified","onkeydown","activeElement","tagName","speed","keyCode","pan","charCodeAt","revealMap","dragStart","startDrag","clientX","clientY","rect","getBoundingClientRect","x","left","y","top","endDrag","moveDrag","onmouseup","onmousemove","onmousedown","addEventListener","preventDefault","touch","changedTouches","closeEditor","openEditor","logInteraction","loadMap","theme","changeSprites","loadState","err","val","toLowerCase","substring","Tile","orientation","symbolMap","Ground","Tree","Stump","Start","Empty","Wall","Door","DoorOpen","Water","Wilson","Exploded","tile","feature","linkN","linkS","linkE","linkW","n","s","w","tileCondition","X","WX","EX","SX","NX","NW","NE","SW","SE","NS","EW","S","N","W","E","A","filter","isGround","waterN","waterS","waterE","waterW","groundN","groundS","groundE","groundW","SU","NU","WU","EU","O","result","layer","prefix","Symbol","keyFor","bounding","getBoundingType","linking","getLinkingType","includes","RogueGame","stateString","startingState","layers","createLayers","sheet","fill","stroke","explosions","isStartingState","parse","isWin","index","ruleset","setState","update","push","perform","reason","toUpperCase","updateVisited","changeLayers","getWindow","py","player","px","inBounds","cell","startCell","mapData","indexOf","wallFeatures","featurePresent","features","notFeatures","assign","backgroundLayer","tiles","getLayer","foregroundLayer","wallLayer","extrasLayer","playerLayer","visibleLayer","visitedLayer","windStr","tileToChar","wx","wy","North","South","West","East","slice","fillExtraFeatures","calculateOrientation","findPlayer","NORTH","SOUTH","EAST","WEST","GridWorld","initData","gridHeight","background","gridPan","loadSprites","spritesheet","spriteSheetUrl","src","Image","image","dt","drag","gridDx","gridDy","dx","dy","ctx","context","scale","offsetX","offsetY","textWidth","sprite","imageSmoothingEnabled","gridI","strokeStyle","strokeRect","complete","drawImage","fillRect","clearRect","drawLayer","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","setTimeout","callback","cancelAnimationFrame","webkitCancelAnimationFrame","mozCancelAnimationFrame","oCancelAnimationFrame","msCancelAnimationFrame","clearTimeout","Game","new","TypeError","Error","position","innerWidth","max","innerHeight","running","frameRequest","processFrame","step","lastStep","Date","now","draw","PassableTerrain","RuleSet","coord","iToCoord","coordToI","dir","facing","inFront","actions","oldLocation","location","canMove","inventoryAt","splice","pickups","tileDirs","north","south","east","west","link","delegate","TileTypes","for","FeatureTypes","PlayerChars","PlayerDirections","InventoryTypes"],"mappings":"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","file":"app.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 770f4efdc27577d5fe72\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 770f4efdc27577d5fe72","import RogueGame from './RogueGame.js';\nimport {InventoryTypes} from './Constants';\n\nconst OL = window.OL;\nconst getEl = (id) => document.getElementById(id);\n\nconst uploadFile = (file, url, onLoad, onError) => {\n  const xhr = new XMLHttpRequest();\n\n  xhr.onload = onLoad;\n  xhr.onerror = onError;\n\n  xhr.open('PUT', url);\n  xhr.overrideMimeType(file.type);\n  xhr.setRequestHeader('Access-Control-Allow-Origin', '*');\n  xhr.setRequestHeader('Access-Control-Expose-Headers', 'Access-Control-Allow-Origin');\n  xhr.send(file);\n};\n\nconst init = () => {\n  let artStyles = [];\n  let selectedStyle = 0;\n  if (OL) {\n    OL.resize(720, true);\n    OL.on('resize', () => {\n      window.onresize();\n    });\n    // Running as OpenLearning widget\n    let map;\n    let spriteSheets = [{\n        name: 'Robot in the Wilderness',\n        url: 'assets/sprites.png'\n      },\n      {\n        name: 'I drew this in MS Paint',\n        url: 'assets/sprites2.png'\n      }\n    ];\n\n    if (OL.mode === 'exhibit') {\n      map = OL.exhibit.data.map;\n      spriteSheets = OL.exhibit.data.sprites;\n      selectedStyle = OL.exhibit.data.selectedStyle || 0;\n    } else if (OL.user.data) {\n      map = OL.user.data.map;\n      spriteSheets = spriteSheets.concat(OL.user.data.sprites || []);\n      selectedStyle = OL.user.data.selectedStyle || 0;\n\n      const shareButton = getEl('editor-share');\n      shareButton.style.display = '';\n      shareButton.onclick = () => {\n        const mapVal = getEl('edit-text').value;\n        const rows = mapVal.trim().split('\\n');\n\n        if (rows.length === 0) {\n          alert('Please enter a map to share');\n          return;\n        }\n\n        const tempCanvas = document.createElement('canvas');\n        const tmpCtx = tempCanvas.getContext('2d');\n        const size = 14;\n\n        tmpCtx.fillStyle = 'black';\n        tmpCtx.font = size + 'px monospace';\n        const bounds = tmpCtx.measureText(rows[0]);\n        tempCanvas.width = bounds.width;\n        const ySize = Math.floor(bounds.width/rows[0].length);\n        tempCanvas.height = rows.length * ySize;\n        tmpCtx.font = size + 'px monospace';\n\n        rows.forEach((row, i) => {\n          tmpCtx.fillText(row, 0, i * ySize);\n        })\n        const thumbnail = tempCanvas.toDataURL();\n\n        OL.user.share('widget', {\n          thumbnail: thumbnail,\n          map: mapVal,\n          sprites: artStyles,\n          selectedStyle: selectedStyle\n        });\n      };\n    }\n\n    if (map) {\n      getEl('edit-text').value = map;\n    }\n\n    if (spriteSheets && spriteSheets.length > 0) {\n      artStyles = spriteSheets;\n    }\n  }\n\n  const artStylesSelect = getEl('theme');\n  artStyles.forEach((style, i) => {\n    const option = document.createElement('option');\n    option.text = style.name;\n    option.value = style.url;\n    artStylesSelect.appendChild(option);\n  });\n\n  if (OL && OL.mode === 'display') {\n    const customOption = document.createElement('option');\n    customOption.text = 'Custom: Upload your own';\n    customOption.value = 'CUSTOM';\n    artStylesSelect.appendChild(customOption);\n\n    const uploadButton = getEl('theme-save');\n    uploadButton.onclick = () => {\n      const file = getEl('theme-file').files[0];\n\n      if (file) {\n        uploadButton.dataset.loading = 'true';\n        OL.files.create('sprites.png', function(response) {\n          var storageKey = response.storageKey;\n          var uploadURL  = response.uploadURL;\n          uploadFile(file, uploadURL, () => {\n            OL.files.getURLs([storageKey], (urls) => {\n              uploadButton.dataset.loading = 'false';\n              const newStyle = {\n                name: getEl('theme-name').value,\n                url: urls[0]\n              };\n              artStyles.unshift(newStyle);\n              const newOption = document.createElement('option');\n              newOption.text = newStyle.name;\n              newOption.value = newStyle.url;\n              artStylesSelect.insertBefore(newOption, artStylesSelect.firstChild);\n              artStylesSelect.value = newStyle.url;\n              selectedStyle = 0;\n              getEl('theme-upload').style.display = 'none';\n            });\n          });\n        });\n      }\n    };\n  }\n\n  artStylesSelect.onchange = (evt) => {\n    const selected = evt.target;\n    if (selected.selectedIndex >= artStyles.length) {\n      getEl('theme-upload').style.display = '';\n      getEl('theme-name').value = '';\n    } else {\n      getEl('theme-upload').style.display = 'none';\n      selectedStyle = selected.selectedIndex;\n    }\n  };\n\n  artStylesSelect.value = artStyles[selectedStyle].url;\n\n\n  let isEditorOpen = false;\n\n  let gameState = getEl('edit-text').value;\n\n  const canvas = getEl('gameCanvas');\n  let spriteSheet = artStyles[selectedStyle].url;\n  let log = '';\n  const updateLog = () => {\n    const logDisplay = getEl('log');\n    logDisplay.innerText = log.trim();\n    logDisplay.scrollTop = logDisplay.scrollHeight;\n  };\n\n  const onChange = (grid, inventory, visited, isGameOver, message, windowStr) => {\n    getEl('agent-window').innerText = windowStr;\n\n    const inventoryItems = [\n      {\n        id: 'key',\n        symbol: InventoryTypes.Key\n      },\n      {\n        id: 'stone',\n        symbol: InventoryTypes.Stone\n      },\n      {\n        id: 'axe',\n        symbol: InventoryTypes.Axe\n      },\n      {\n        id: 'gold',\n        symbol: InventoryTypes.Gold\n      },\n      {\n        id: 'raft',\n        symbol: InventoryTypes.Raft\n      },\n      {\n        id: 'dynamite',\n        symbol: InventoryTypes.Dynamite\n      },\n    ];\n\n    inventoryItems.forEach((item) => {\n      const element = getEl(item.id);\n      let count = 0;\n      inventory.forEach(inventoryItem => {\n        if (inventoryItem === item.symbol) {\n          count++;\n        }\n      });\n\n      if (count > 0) {\n        element.style.display = '';\n        if (count > 1) {\n          element.innerText = count;\n        } else {\n          element.innerText = '';\n        }\n      } else {\n        element.style.display = 'none';\n      }\n    });\n\n    if (message || isGameOver) {\n      log += message + '\\n';\n      if (isGameOver) {\n        log += 'Game Over.\\n\\n';\n      }\n\n      updateLog();\n    }\n  };\n\n  const game = new RogueGame(canvas, gameState, spriteSheet, onChange);\n  const gridWorld = game.gridWorld;\n\n  const initIcons = () => {\n    const inventoryIcons = Array.from(getEl('inventory').getElementsByTagName(\"LI\"));\n    const iconPositions = {\n      axe: [0, 0],\n      key: [2, 2],\n      dynamite: [6, 0],\n      raft: [3, 3],\n      gold: [7, 0]\n    };\n    const gridSize = 64;\n    const gridWidth = 8;\n    const media = window.matchMedia(\"(max-width: 480px)\");\n    inventoryIcons.forEach(icon => {\n      const pos = iconPositions[icon.id];\n      const size = media.matches ? 32 : 64;\n\n      if (pos) {\n        icon.style.backgroundImage = `url(\"${spriteSheet}\")`;\n        icon.style.backgroundSize = `${size * gridWidth}px`;\n        icon.style.backgroundPosition = `${-pos[0] * size}px ${-pos[1] * size}px`;\n      }\n    });\n  };\n  initIcons();\n\n  const actionButtons = {\n    l: getEl('action-l'),\n    r: getEl('action-r'),\n    f: getEl('action-f'),\n    c: getEl('action-c'),\n    u: getEl('action-u'),\n    b: getEl('action-b')\n  };\n\n  const actionHandler = (action) => (e) => game.performAction(action);\n\n  Object.keys(actionButtons).forEach((key) => {\n    actionButtons[key].onclick = actionHandler(key);\n  });\n\n  window.onblur = () => gridWorld.stop();\n  window.onfocus = () => gridWorld.run();\n  window.onresize = () => gridWorld.hasModified = true;\n  window.onkeydown = (e) => {\n    if (isEditorOpen) return;\n    if (document.activeElement.tagName === 'INPUT') return;\n\n    const speed = 8;\n    switch (e.keyCode) {\n      case 38: gridWorld.pan(0, -speed); break;\n      case 40: gridWorld.pan(0,  speed); break;\n      case 37: gridWorld.pan(-speed, 0); break;\n      case 39: gridWorld.pan(speed,  0); break;\n      case 'L'.charCodeAt(0): game.performAction('l'); break;\n      case 'R'.charCodeAt(0): game.performAction('r'); break;\n      case 'F'.charCodeAt(0): game.performAction('f'); break;\n      case 'C'.charCodeAt(0): game.performAction('c'); break;\n      case 'U'.charCodeAt(0): game.performAction('u'); break;\n      case 'B'.charCodeAt(0): game.performAction('b'); break;\n\n      case 'A'.charCodeAt(0): game.performAction('l'); break;\n      case 'D'.charCodeAt(0): game.performAction('r'); break;\n      case 'W'.charCodeAt(0): game.performAction('f'); break;\n      case 'Q'.charCodeAt(0): game.performAction('c'); break;\n      case 'E'.charCodeAt(0): game.performAction('u'); break;\n      case 'S'.charCodeAt(0): game.performAction('b'); break;\n\n      case '0'.charCodeAt(0): game.revealMap(); break;\n      default: break;\n    }\n  }\n\n  let dragStart = null;\n  const startDrag = (clientX, clientY) => {\n    const rect = canvas.getBoundingClientRect();\n    dragStart = {\n      x: clientX - rect.left,\n      y: clientY - rect.top,\n      rect: rect\n    };\n    gridWorld.startDrag(dragStart.x, dragStart.y);\n  };\n  const endDrag = () => {\n    dragStart = null;\n  };\n  const moveDrag = (clientX, clientY) => {\n    if (dragStart) {\n      gridWorld.moveDrag(\n        clientX - dragStart.rect.left,\n        clientY - dragStart.rect.top\n      );\n    }\n  };\n  window.onmouseup = (e) => {\n    endDrag();\n  };\n  window.onmousemove = (e) => {\n    moveDrag(e.clientX, e.clientY);\n  };\n  canvas.onmousedown = (e) => {\n    startDrag(e.clientX, e.clientY);\n  };\n  canvas.addEventListener('touchstart', (e) => {\n    e.preventDefault();\n    const touch = e.changedTouches[0];\n    if (!touch) return;\n    startDrag(touch.clientX, touch.clientY);\n  });\n  canvas.addEventListener('touchend', (e) => {\n    endDrag();\n  });\n  canvas.addEventListener('touchcancel', (e) => {\n    endDrag();\n  });\n  canvas.addEventListener('touchmove', (e) => {\n    e.preventDefault();\n    const touch = e.changedTouches[0];\n    if (!touch) return;\n    moveDrag(touch.clientX, touch.clientY);\n  });\n\n  const closeEditor = () => {\n    getEl('editor').style.display = 'none';\n    isEditorOpen = false;\n  };\n  const openEditor = () => {\n    if (OL) OL.user.logInteraction();\n\n    getEl('editor').style.display = '';\n    isEditorOpen = true;\n  };\n\n  getEl('close-editor').onclick = closeEditor;\n  getEl('edit').onclick = openEditor;\n\n  const loadMap = () => {\n    gameState = getEl('edit-text').value;\n    const theme = getEl('theme').value;\n\n    if (theme === 'CUSTOM') {\n      alert(\"No theme uploaded.\");\n    } else {\n      try {\n        spriteSheet = theme;\n        gridWorld.changeSprites(theme);\n        initIcons();\n        game.loadState(gameState, [], []);\n        getEl('editor').style.display = 'none';\n        isEditorOpen = false;\n      } catch (err) {\n        //throw err;\n        alert(err);\n      }\n    }\n  };\n\n  getEl('editor-save').onclick = loadMap;\n\n  getEl('reset').onclick = () => {\n    log = 'Reset.\\n';\n    updateLog();\n    try {\n      game.loadState(gameState, [], []);\n    } catch (err) {\n      alert(err);\n    }\n  };\n\n  getEl('instructions-run').onclick = () => {\n    const val = getEl('instructions-input').value;\n    if (val.length === 0) {\n      return;\n    }\n    game.performAction(val[0].toLowerCase());\n    getEl('instructions-input').value = val.substring(1);\n  };\n\n  gridWorld.run();\n};\n\n\nwindow.onload = () => {\n  if (OL) {\n    OL(init);\n  } else {\n    init();\n  }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./index.js\n\n\n// WEBPACK FOOTER //\n// ./index.js","import GridWorld from './GridWorld.js';\nimport RuleSet from './RuleSet.js';\nimport {TileTypes, FeatureTypes, InventoryTypes, PlayerChars, PlayerDirections} from './Constants.js';\n\nclass Tile {\n  constructor(symbol, orientation = null) {\n    const symbolMap = {\n      'T': [TileTypes.Ground, FeatureTypes.Tree],\n      't': [TileTypes.Ground, FeatureTypes.Stump], // extra, shimmed in\n      'a': [TileTypes.Ground, FeatureTypes.Axe],\n      'k': [TileTypes.Ground, FeatureTypes.Key],\n      // 'o': [TileTypes.Ground, FeatureTypes.Stone],\n      '$': [TileTypes.Ground, FeatureTypes.Gold],\n      'x': [TileTypes.Ground, FeatureTypes.Start], // extra, shimmed in\n      ' ': [TileTypes.Ground, FeatureTypes.Empty],\n      '-': [TileTypes.Wall,   FeatureTypes.Door],\n      '!': [TileTypes.Wall,   FeatureTypes.DoorOpen], // extra, shimmed in\n      '*': [TileTypes.Wall,   FeatureTypes.Wall],\n      '~': [TileTypes.Water,  FeatureTypes.Empty],\n      // 'O': [TileTypes.Water,  FeatureTypes.Stone],\n      'd': [TileTypes.Ground, FeatureTypes.Dynamite],\n      'w': [TileTypes.Ground, FeatureTypes.Wilson], // ???\n      'D': [TileTypes.Ground, FeatureTypes.Exploded] // extra, shimmed in\n    };\n\n    const [tile, feature] = symbolMap[symbol];\n\n    this.tile = tile;\n    this.feature = feature;\n    this.orientation = orientation;\n  }\n\n  getLinkingType() {\n    if (this.orientation === null) return null;\n\n    const {linkN, linkS, linkE, linkW} = this.orientation;\n    const [n, s, e, w] = [linkN, linkS, linkE, linkW];\n\n    // Name for every linking type, as a combination of N/S/E/W\n    const tileCondition = {\n      X:  n &&  s &&  e &&  w,\n\n      WX: n &&  s &&  e && !w,\n      EX: n &&  s && !e &&  w,\n      SX: n && !s &&  e &&  w,\n      NX:!n &&  s &&  e &&  w,\n\n      NW:!n &&  s &&  e && !w,\n      NE:!n &&  s && !e &&  w,\n      SW: n && !s &&  e && !w,\n      SE: n && !s && !e &&  w,\n\n      NS: n &&  s && !e && !w,\n      EW:!n && !s &&  e &&  w,\n\n      S:  n && !s && !e && !w,\n      N: !n &&  s && !e && !w,\n      W: !n && !s &&  e && !w,\n      E: !n && !s && !e &&  w,\n\n      A: !n && !s && !e && !w\n    };\n\n    return Object.keys(tileCondition).filter((key) => tileCondition[key])[0];\n  }\n\n  getBoundingType(isGround=false) {\n    if (this.orientation === null) return null;\n\n    const {\n      waterN, waterS, waterE, waterW,\n      groundN, groundS, groundE, groundW\n    } = this.orientation;\n\n    const [n, s, e, w] = isGround ?\n      [groundN, groundS, groundE, groundW] :\n      [waterN, waterS, waterE, waterW];\n\n    // Name for every bounding type, as a combination of N/S/E/W\n    const tileCondition = {\n      NW:!n &&  s &&  e && !w,\n      NE:!n &&  s && !e &&  w,\n      SW: n && !s &&  e && !w,\n      SE: n && !s && !e &&  w,\n\n      SU:  n && !s && !e && !w,\n      NU: !n &&  s && !e && !w,\n      WU: !n && !s &&  e && !w,\n      EU: !n && !s && !e &&  w,\n\n      O: !n && !s && !e && !w\n    };\n\n    const result = Object.keys(tileCondition).filter((key) => tileCondition[key]);\n\n    if (result.length === 1) {\n      return result[0];\n    } else {\n      return null;\n    }\n  }\n\n  getLayer(layer) {\n    let prefix = null;\n    let key = null;\n\n    if (layer === 0) {\n      if (this.tile === TileTypes.Water) {\n        key = Symbol.keyFor(TileTypes.Water);\n      } else {\n        key = Symbol.keyFor(TileTypes.Ground);\n      }\n\n      const bounding = this.getBoundingType(this.tile !== TileTypes.Water);\n      if (bounding) {\n        key = bounding + '-' + key;\n      }\n    } else if (layer === 1 && this.tile !== TileTypes.Wall) {\n      key = Symbol.keyFor(this.tile);\n\n      if (this.feature === FeatureTypes.Empty) {\n        prefix = null;\n      } else {\n        prefix = Symbol.keyFor(this.feature);\n      }\n\n      if (key !== null && prefix !== null) {\n        key = prefix + '-' + key;\n      } else {\n        key = null;\n      }\n    } else if (layer === 2 && this.tile === TileTypes.Wall) {\n      let linking = this.getLinkingType();\n      if (this.feature === FeatureTypes.Door || this.feature === FeatureTypes.DoorOpen) {\n        if (['S', 'N', 'SX', 'NX', 'NS'].includes(linking)) {\n          linking = 'NS';\n        } else {\n          linking = 'EW';\n        }\n      }\n      key = linking + '-' + Symbol.keyFor(this.feature);\n    }\n\n    return key;\n  }\n}\n\nexport default class RogueGame {\n  constructor(canvas, stateString, spriteSheet, onChange) {\n    this.canvas = canvas;\n    this.onChange = onChange;\n    this.startingState = null;\n    this.loadState(stateString);\n    const layers = this.createLayers(this.grid);\n    const [width, height] = [this.grid.width, this.grid.height];\n\n    this.gridWorld = new GridWorld(this.canvas, {\n      \"width\": width,\n      \"height\": height,\n      \"size\": 64,\n      \"pan\": [width / 2, height / 2],\n      \"grid\": layers,\n      \"spritesheet\": spriteSheet,\n      \"sprites\": {\n        \"Axe-Ground\":      {sheet: {x: 0, y: 0}},\n        \"Exploded-Ground\": {sheet: {x: 1, y: 0}},\n        \"EW-Door\":         {sheet: {x: 2, y: 0}},\n        \"NS-Door\":         {sheet: {x: 3, y: 0}},\n        \"EW-DoorOpen\":     {sheet: {x: 4, y: 0}},\n        \"NS-DoorOpen\":     {sheet: {x: 5, y: 0}},\n        \"Dynamite-Ground\": {sheet: {x: 6, y: 0}},\n        \"Gold-Ground\":     {sheet: {x: 7, y: 0}},\n\n        \"EU-Ground\": {sheet: {x: 0, y: 1}},\n        \"NE-Ground\": {sheet: {x: 1, y: 1}},\n        \"NU-Ground\": {sheet: {x: 2, y: 1}},\n        \"NW-Ground\": {sheet: {x: 3, y: 1}},\n        \"O-Ground\":  {sheet: {x: 4, y: 1}},\n        \"SE-Ground\": {sheet: {x: 5, y: 1}},\n        \"SU-Ground\": {sheet: {x: 6, y: 1}},\n        \"SW-Ground\": {sheet: {x: 7, y: 1}},\n\n        \"WU-Ground\":  {sheet: {x: 0, y: 2}},\n        \"Ground\":     {sheet: {x: 1, y: 2}},\n        \"Key-Ground\": {sheet: {x: 2, y: 2}},\n\n        \"a>\": {sheet: {x: 3, y: 2}},\n        \"a^\": {sheet: {x: 4, y: 2}},\n        \"av\": {sheet: {x: 5, y: 2}},\n        \"a<\": {sheet: {x: 6, y: 2}},\n        \">\":  {sheet: {x: 7, y: 2}},\n        \"^\":  {sheet: {x: 0, y: 3}},\n        \"v\":  {sheet: {x: 1, y: 3}},\n        \"<\":  {sheet: {x: 2, y: 3}},\n\n        \"Raft\": {sheet: {x: 3, y: 3}},\n\n        \"Start-Ground\": {sheet: {x: 4, y: 3}},\n        \"Stump-Ground\": {sheet: {x: 5, y: 3}},\n        \"Tree-Ground\":  {sheet: {x: 6, y: 3}},\n\n        \"A-Wall\": {sheet: {x: 7, y: 3}},\n\n        \"E-Wall\":  {sheet: {x: 0, y: 4}},\n        \"EW-Wall\": {sheet: {x: 1, y: 4}},\n        \"EX-Wall\": {sheet: {x: 2, y: 4}},\n\n        \"N-Wall\":  {sheet: {x: 3, y: 4}},\n        \"NE-Wall\": {sheet: {x: 4, y: 4}},\n        \"NS-Wall\": {sheet: {x: 5, y: 4}},\n        \"NW-Wall\": {sheet: {x: 6, y: 4}},\n        \"NX-Wall\": {sheet: {x: 7, y: 4}},\n\n        \"S-Wall\":  {sheet: {x: 0, y: 5}},\n        \"SE-Wall\": {sheet: {x: 1, y: 5}},\n        \"SW-Wall\": {sheet: {x: 2, y: 5}},\n        \"SX-Wall\": {sheet: {x: 3, y: 5}},\n\n        \"W-Wall\":  {sheet: {x: 4, y: 5}},\n        \"WX-Wall\": {sheet: {x: 5, y: 5}},\n        \"X-Wall\":  {sheet: {x: 6, y: 5}},\n\n        \"EU-Water\": {sheet: {x: 7, y: 5}},\n        \"NE-Water\": {sheet: {x: 0, y: 6}},\n        \"NU-Water\": {sheet: {x: 1, y: 6}},\n        \"NW-Water\": {sheet: {x: 2, y: 6}},\n        \"O-Water\":  {sheet: {x: 3, y: 6}},\n        \"SE-Water\": {sheet: {x: 4, y: 6}},\n        \"SU-Water\": {sheet: {x: 5, y: 6}},\n        \"SW-Water\": {sheet: {x: 6, y: 6}},\n        \"WU-Water\": {sheet: {x: 7, y: 6}},\n        \"Water\": {sheet: {x: 0, y: 7}},\n        \"Wilson-Ground\": {sheet: {x: 1, y: 7}},\n\n        \"Unseen\": {fill: 'rgba(0, 0, 0, 0.4)', stroke: 'rgba(96, 96, 96, 0.8)'},\n        \"Unvisited\": {fill: 'rgba(0, 0, 0, 0.8)', stroke: 'rgba(32, 32, 32, 0.8)'}\n      }\n    });\n  }\n\n  loadState(stateString, visited=null, inventory=null, explosions=null, isStartingState=true) {\n    this.explosions = [];\n\n    if (explosions) {\n      this.explosions = explosions;\n    }\n\n    if (isStartingState) {\n      this.startingState = null;\n    }\n\n    try {\n      this.grid = this.parse(stateString);\n    } catch (err) {\n      throw \"Unable to parse the map.\";\n    }\n\n    this.isGameOver = false;\n    this.isWin = false;\n    this.visited = Array(this.grid.width * this.grid.height).fill('Unvisited');\n\n    if (inventory) {\n      this.inventory = inventory;\n    }\n\n    if (!this.inventory) {\n      this.inventory = [];\n    }\n\n    if (visited) {\n      visited.forEach((value, index) => this.visited[index] = null);\n    }\n\n    if (!this.ruleset) {\n      this.ruleset = new RuleSet(this.grid, this.inventory, this.explosions);\n    } else {\n      this.ruleset.setState(this.grid, this.inventory, this.explosions);\n    }\n\n    this.update('Map Loaded.');\n  }\n\n  getVisited() {\n    const visited = [];\n    this.visited.forEach((value, index) => {\n      if (value === null) visited.push(index);\n    });\n    return visited;\n  }\n\n  performAction(action) {\n    if (this.isGameOver || this.isWin) return;\n\n    let message;\n\n    try {\n      message = this.ruleset.perform(action);\n      if (message === true) {\n        this.isWin = true;\n      }\n    } catch (err) {\n      if (err.type === 'dead') {\n        if (err.reason === 'drowned') {\n          message = 'Agent fell into water and drowned';\n        } else if (err.reason === 'outside') {\n          message = 'Agent wandered off and got lost in the wilderness';\n        } else {\n          message = 'Agent died... somehow';\n        }\n\n        this.isGameOver = true;\n      } else {\n        throw err;\n      }\n    }\n\n    if (message === true) {\n      message = 'Gold has been collected.\\nMission successful!\\n';\n    }\n\n    this.update(action.toUpperCase() + ': ' + message);\n  }\n\n  update(message) {\n    this.updateVisited(this.grid);\n\n    if (this.gridWorld) {\n      const layers = this.createLayers(this.grid);\n      const [width, height] = [this.grid.width, this.grid.height];\n\n      this.gridWorld.changeLayers(layers, width, height);\n      this.gridWorld.hasModified = true;\n    }\n\n    if (this.onChange) {\n      this.onChange(this.grid, this.inventory, this.visited, this.isGameOver || this.isWin, message, this.getWindow());\n    }\n  }\n\n  updateVisited(grid) {\n    const py = Math.floor(grid.player.index / grid.width);\n    const px = (grid.player.index % grid.width);\n    for (let y = py - 2; y <= py + 2; y++) {\n      for (let x = px - 2; x <= px + 2; x++) {\n        if (this.inBounds(x, y, grid)) {\n          this.visited[y * grid.width + x] = null;\n        }\n      }\n    }\n  }\n\n  fillExtraFeatures(cell, i) {\n    // infer hidden or unspecified features\n    const startCell = this.startingState[i];\n\n    if (PlayerChars.includes(cell)) {\n      // infer what cell the player is standing on\n      if (startCell === '~') {\n        // in the water\n        cell = 'O'; // player must be standing on a stone\n      } else if (startCell === '-') {\n        // in a doorway\n        cell = '-'; // player must be standing in a doorway\n      } else {\n        cell = ' '; // player must be standing on the ground\n      }\n    }\n\n    if (cell === ' ') {\n      if (startCell === 'T') {\n        // This was a tree when we started\n        cell = 't'; // now a stump\n      } else if (startCell === '-') {\n        // This was a doorway\n        cell = '!'; // now an open door\n      } else if (PlayerChars.includes(startCell)) {\n        // This is where the player started\n        cell = 'x'; // mark starting location\n      }\n    }\n\n    if (this.explosions.includes(cell)) {\n      cell = 'D';\n    }\n\n    return cell;\n  }\n\n  findPlayer(mapData) {\n    const player = {\n      index: null,\n      orientation: null\n    };\n\n    mapData.forEach((cell, i) => {\n      const orientation = PlayerChars.indexOf(cell);\n      if (orientation >= 0) {\n        player.index = i;\n        player.orientation = orientation;\n      }\n    });\n\n    return player;\n  }\n\n  calculateOrientation(cell, i, mapData, width, height) {\n    const wallFeatures = ['-', '!', '*'];\n    let orientation = {};\n\n    const featurePresent = (x, y, features, notFeatures) => {\n      if ((x >= 0 && x < width) && (y >= 0 && y < height)) {\n        if (features) {\n          return features.includes(mapData[y * width + x]);\n        } else {\n          return !notFeatures.includes(mapData[y * width + x]);\n        }\n      } else {\n        if (!features || features.includes('~')) {\n          return true;\n        } else {\n          return false;\n        }\n      }\n    }\n\n    const y = Math.floor(i / width);\n    const x = (i % width);\n\n    if (wallFeatures.includes(cell)) {\n      Object.assign(orientation, {\n        linkN: featurePresent(x, y - 1, wallFeatures),\n        linkS: featurePresent(x, y + 1, wallFeatures),\n        linkE: featurePresent(x + 1, y, wallFeatures),\n        linkW: featurePresent(x - 1, y, wallFeatures)\n      });\n    }\n\n    if (cell === '~') {\n      Object.assign(orientation, {\n        waterN: featurePresent(x, y - 1, ['~']),\n        waterS: featurePresent(x, y + 1, ['~']),\n        waterE: featurePresent(x + 1, y, ['~']),\n        waterW: featurePresent(x - 1, y, ['~'])\n      });\n    } else {\n      Object.assign(orientation, {\n        groundN: featurePresent(x, y - 1, null, ['~']),\n        groundS: featurePresent(x, y + 1, null, ['~']),\n        groundE: featurePresent(x + 1, y, null, ['~']),\n        groundW: featurePresent(x - 1, y, null, ['~'])\n      });\n    }\n\n    return orientation;\n  }\n\n  inBounds(x, y, grid) {\n    const [width, height] = [grid.width, grid.height];\n    return (x >= 0 && x < width) && (y >= 0 && y < height);\n  }\n\n  createLayers(grid) {\n    const backgroundLayer = grid.tiles.map(tile => tile.getLayer(0));\n    const foregroundLayer = grid.tiles.map(tile => tile.getLayer(1));\n    const wallLayer       = grid.tiles.map(tile => tile.getLayer(2));\n    const extrasLayer     = Array(grid.width * grid.height).fill(null);\n    const playerLayer     = Array(grid.width * grid.height).fill(null);\n    const visibleLayer    = Array(grid.width * grid.height).fill('Unseen');\n    const visitedLayer    = this.visited;\n\n    if (!this.isGameOver) {\n\n      if (this.inventory.includes(InventoryTypes.Axe)) {\n        playerLayer[grid.player.index] = 'a' + PlayerChars[grid.player.orientation];\n      } else {\n        playerLayer[grid.player.index] = PlayerChars[grid.player.orientation];\n      }\n      if (\n        this.inventory.includes(InventoryTypes.Raft) &&\n        grid.tiles[grid.player.index].tile === TileTypes.Water\n      ) {\n        extrasLayer[grid.player.index] = 'Raft';\n      }\n    }\n\n    const py = Math.floor(grid.player.index / grid.width);\n    const px = (grid.player.index % grid.width);\n    for (let y = py - 2; y <= py + 2; y++) {\n      for (let x = px - 2; x <= px + 2; x++) {\n        if (this.inBounds(x, y, grid)) {\n          visibleLayer[y * grid.width + x] = null;\n        }\n      }\n    }\n\n    return [backgroundLayer, foregroundLayer, wallLayer, extrasLayer, playerLayer, visibleLayer, visitedLayer, null];\n  }\n\n  revealMap() {\n    this.visited = Array(this.grid.width * this.grid.height).fill(null);\n    this.update('Revealed Map');\n  }\n\n  getWindow() {\n    const grid = this.grid;\n    const py = Math.floor(grid.player.index / grid.width);\n    const px = (grid.player.index % grid.width);\n    const size = 5;\n    let windStr = '';\n\n    const tileToChar = (x, y) => {\n      const tile = grid.tiles[y * grid.width + x];\n      if (tile.tile === TileTypes.Ground) {\n        switch (tile.feature) {\n          case FeatureTypes.Tree:  return 'T';\n          case FeatureTypes.Axe:   return 'a';\n          case FeatureTypes.Key:   return 'k';\n          case FeatureTypes.Stone: return 'o';\n          case FeatureTypes.Gold:  return 'g';\n          case FeatureTypes.Dynamite: return 'd';\n          case FeatureTypes.Wilson: return '?';\n          default: return ' ';\n        }\n      } else if (tile.tile === TileTypes.Wall) {\n        switch (tile.feature) {\n          case FeatureTypes.Door:  return '-';\n          default: return '*';\n        }\n      } else if (tile.tile === TileTypes.Water) {\n        switch (tile.feature) {\n          case FeatureTypes.Stone: return 'O';\n          default: return '~';\n        }\n      }\n    };\n\n    for (let i = 0; i < size*size; ++i) {\n      if (i % size === 0 && i !== 0) {\n          windStr += '\\n';\n      }\n\n      const [wx, wy] = [i % size - 2, Math.floor(i / size) - 2];\n      let x, y;\n\n      switch (grid.player.orientation) {\n        case PlayerDirections.North: x = px + wx, y = py + wy; break;\n        case PlayerDirections.South: x = px - wx, y = py - wy; break;\n        case PlayerDirections.West : x = px + wy, y = py - wx; break;\n        case PlayerDirections.East : x = px - wy, y = py + wx; break;\n      }\n\n      if (this.inBounds(x, y, grid)) {\n        windStr += tileToChar(x, y);\n      } else {\n        windStr += '.';\n      }\n    }\n\n    return windStr;\n  }\n\n  parse(stateString) {\n    const rows   = stateString.split('\\n').filter(row => row.length > 0);\n    const height = rows.length;\n    const width  = rows[0].length;\n    const data   = [];\n\n    rows.forEach(row => {\n      if (row.length === width) {\n        row.split('').forEach(cell => data.push(cell));\n      } else {\n        throw \"Incorrect width\";\n      }\n    });\n\n    if (!this.startingState) {\n      this.startingState = data.slice();\n    }\n\n    const tiles = data.map((cell, i) => {\n      cell = this.fillExtraFeatures(cell, i);\n      const orientation = this.calculateOrientation(cell, i, data, width, height);\n      return new Tile(cell, orientation);\n    });\n\n    const player = this.findPlayer(data);\n\n    return {\n      width: width,\n      height: height,\n      tiles: tiles,\n      player: player\n    };\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./RogueGame.js\n\n\n// WEBPACK FOOTER //\n// ./RogueGame.js","import Game from './Game.js';\n\nconst NORTH = 0;\nconst SOUTH = 1;\nconst EAST = 2;\nconst WEST = 3;\n\nexport default class GridWorld extends Game {\n  /*\n    initData = {\n      \"width\": 2,\n      \"height\": 2,\n      \"size\": 64,\n      \"pan\": [1, 1],\n      \"grid\": [\n        \"a\", null,\n        null, \"b\"\n      ],\n      \"sprites\": {\n        \"a\": \"https://www.example.com/a.png\",\n        \"b\": [\n          \"https://www.example.com/b1.png\",\n          \"https://www.example.com/b2.png\",\n          \"https://www.example.com/b3.png\",\n          \"https://www.example.com/b4.png\"\n        ]\n      }\n    }\n  */\n  constructor(canvas, initData) {\n    super(canvas);\n    this.gridWidth = initData.width;\n    this.gridHeight = initData.height;\n    this.gridSize = initData.size;\n    this.background = initData.background || [];\n    this.grid = initData.grid || [[]];\n    for (const layer of this.grid) {\n      if (layer) {\n        layer.length = this.gridWidth * this.gridHeight;\n      }\n    }\n    this.gridPan = initData.pan || [Math.floor(gridWidth/2), Math.floor(gridHeight/2)];\n    this.loadSprites(initData.sprites, initData.spritesheet)\n    this.hasModified = true;\n  }\n\n  changeLayers(layers=this.grid, width=this.gridWidth, height=this.gridHeight, size=this.gridSize) {\n    this.grid = layers;\n    this.gridWidth = width;\n    this.gridHeight = height;\n    this.gridSize = size;\n  }\n\n  changeSprites(spriteSheetUrl) {\n    if (spriteSheetUrl) {\n      if (this.spritesheet && spriteSheetUrl === this.spritesheet.src) {\n        return;\n      }\n      this.spritesheet = new Image();\n      this.spritesheet.src = spriteSheetUrl;\n      this.spritesheet.onload = () => this.hasModified = true;\n    }\n  }\n\n  loadSprites(sprites, spritesheet) {\n    this.sprites = sprites || {};\n    Object.keys(this.sprites).forEach(key => {\n      if (typeof this.sprites[key] === 'string') {\n        const image = new Image();\n        image.src = this.sprites[key];\n        image.onload = () => this.hasModified = true;\n        this.sprites[key] = image;\n      }\n    });\n\n    this.changeSprites(spritesheet)\n  }\n\n  update(dt) {\n    return this.hasModified;\n  }\n\n  lookup(x, y) {\n    return this.grid[y * this.gridWidth + x];\n  }\n\n  startDrag(x, y) {\n    this.drag = {\n      x: x,\n      y: y,\n      pan: {\n        x: this.gridPan[0],\n        y: this.gridPan[1]\n      }\n    };\n  }\n\n  moveDrag(x, y) {\n    if (!this.drag) return;\n\n    const gridDx = -(x - this.drag.x)/this.gridSize;\n    const gridDy = -(y - this.drag.y)/this.gridSize;\n\n    this.gridPan[0] = this.drag.pan.x + gridDx;\n    this.gridPan[1] = this.drag.pan.y + gridDy;\n    this.hasModified = true;\n  }\n\n  endDrag(x, y) {\n    this.drag = null;\n  }\n\n  getPan() {\n    return {\n      x: this.gridPan[0] * this.gridSize,\n      y: this.gridPan[1] * this.gridSize\n    }\n  }\n\n  pan(dx, dy) {\n    this.gridPan[0] -= dx/this.gridSize;\n    this.gridPan[1] -= dy/this.gridSize;\n    this.hasModified = true;\n  }\n\n  panTo(x, y) {\n    this.gridPan[0] = x/this.gridSize;\n    this.gridPan[1] = y/this.gridSize;\n  }\n\n  drawLayer(layer) {\n    const ctx = this.context;\n    const scale = this.gridSize;\n    const offsetX = this.width /2 - this.gridPan[0] * scale;\n    const offsetY = this.height/2 - this.gridPan[1] * scale;\n\n    let x, y;\n    let textWidth, sprite;\n\n    ctx.font = `${scale/2}px sans-serif`;\n    ctx.imageSmoothingEnabled= false;\n\n    let gridI = 0;\n    while (gridI < this.gridWidth * this.gridHeight) {\n      y = offsetY + scale * Math.floor(gridI / this.gridWidth);\n      x = offsetX + scale * (gridI % this.gridWidth);\n\n      if (x < -scale || x > this.width + scale || y < -scale || y > this.height + scale) {\n        gridI++;\n        continue;\n      }\n\n      if (!layer) {\n        ctx.strokeStyle = '#666';\n        ctx.strokeRect(x, y, scale, scale);\n      } else if (layer[gridI]) {\n        sprite = this.sprites[layer[gridI]];\n\n        if (sprite && sprite.complete && sprite instanceof Image) {\n          ctx.drawImage(sprite,\n            0, 0, scale, scale,\n            x, y, scale, scale\n          );\n        } else if (sprite) {\n          if (sprite.fill) {\n            ctx.fillStyle = sprite.fill;\n            ctx.fillRect(x, y, scale, scale);\n          }\n          if (sprite.stroke) {\n            ctx.strokeStyle = sprite.stroke;\n            ctx.strokeRect(x, y, scale, scale);\n          }\n          if (sprite.sheet) {\n            ctx.drawImage(this.spritesheet,\n              sprite.sheet.x * scale, sprite.sheet.y * scale, scale, scale,\n              x, y, scale, scale\n            );\n          }\n        } else {\n          textWidth = ctx.measureText(layer[gridI]).width;\n          ctx.fillText(layer[gridI], x + scale/2 - textWidth/2, y + 5*scale/8);\n        }\n      }\n\n      gridI++;\n    }\n  }\n\n  draw() {\n    const ctx = this.context;\n\n    ctx.clearRect(0, 0, this.width, this.height);\n    ctx.fillStyle = 'black';\n    ctx.fillRect(0, 0, this.width, this.height);\n\n    let layer;\n    for (layer of this.grid) {\n      this.drawLayer(layer)\n    }\n\n    this.hasModified = false;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./GridWorld.js\n\n\n// WEBPACK FOOTER //\n// ./GridWorld.js","const requestAnimationFrame = window.requestAnimationFrame ||\n  window.webkitRequestAnimationFrame ||\n  window.mozRequestAnimationFrame ||\n  window.oRequestAnimationFrame ||\n  window.msRequestAnimationFrame ||\n  (callback => window.setTimeout(callback, 1000 / 60))\n;\n\nconst cancelAnimationFrame = window.cancelAnimationFrame ||\n  window.webkitCancelAnimationFrame ||\n  window.mozCancelAnimationFrame ||\n  window.oCancelAnimationFrame ||\n  window.msCancelAnimationFrame ||\n  window.clearTimeout\n;\n\nexport default class Game {\n  constructor(canvas) {\n    if (new.target === Game) {\n      throw new TypeError(\"Cannot construct an abstract class\");\n    }\n\n    if (typeof canvas === 'string') {\n      this.canvas = document.getElementById(canvas);\n      if (!this.canvas) throw new Error(`Unable to find element with ID: ${canvas}`);\n    } else {\n      this.canvas = canvas;\n    }\n\n    this.canvas.style.position = \"absolute\";\n    this.canvas.style.top = \"0\";\n    this.canvas.style.left = \"0\";\n    this.context = this.canvas.getContext('2d');\n\n    window.onresize = (e) => {\n      this.canvas.width = window.innerWidth;\n      this.canvas.height = Math.max(window.innerHeight, 720);\n      this.width = this.canvas.width;\n      this.height = this.canvas.height;\n    };\n    window.onresize();\n\n    this.running = false;\n    this.frameRequest = null;\n  }\n\n  update(dt) {\n    throw new TypeError(\"Not Implemented: update method is required\");\n  }\n\n  draw() {\n    throw new TypeError(\"Not Implemented: draw method is required\");\n  }\n\n  run() {\n    if (this.running) return;\n\n    this.running = true;\n    const processFrame = () => {\n      this.step();\n      this.frameRequest = requestAnimationFrame(processFrame);\n    };\n\n    this.lastStep = Date.now();\n    this.frameRequest = requestAnimationFrame(processFrame);\n  }\n\n  stop() {\n    if (this.frameRequest) cancelAnimationFrame(this.frameRequest);\n    this.frameRequest = null;\n    this.running = false;\n  }\n\n  step() {\n    const now = Date.now();\n    const dt = (now - this.lastStep) / 1000;\n    this.lastStep = now;\n    if (this.update(dt) !== false) {\n      this.draw();\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./Game.js\n\n\n// WEBPACK FOOTER //\n// ./Game.js","import {TileTypes, FeatureTypes, PlayerChars, InventoryTypes} from './Constants.js';\n\nconst PassableTerrain = [\n  FeatureTypes.Empty,\n  FeatureTypes.Stump,\n  FeatureTypes.Start,\n  FeatureTypes.Axe,\n  FeatureTypes.Key,\n  FeatureTypes.Dynamite,\n  FeatureTypes.Gold,\n  FeatureTypes.Exploded\n];\n\nexport default class RuleSet {\n  constructor(grid, inventory, explosions) {\n    this.setState(grid, inventory, explosions);\n  }\n\n  setState(grid, inventory, explosions) {\n    this.grid = grid;\n    this.inventory = inventory;\n    this.explosions = explosions;\n  }\n\n  iToCoord(i) {\n    const x = (i % this.grid.width);\n    const y = Math.floor(i / this.grid.width);\n\n    return [x, y];\n  }\n\n  coordToI(coord) {\n    const [x, y] = coord;\n\n    if (!this.inBounds(x, y)) {\n      return -1;\n    } else {\n      return y * this.grid.width + x;\n    }\n  }\n\n  inBounds(x, y) {\n    const [width, height] = [this.grid.width, this.grid.height];\n    return (x >= 0 && x < width) && (y >= 0 && y < height);\n  }\n\n  north(i) {\n    const [x, y] = this.iToCoord(i);\n    return this.coordToI([x, y-1]);\n  }\n\n  south(i) {\n    const [x, y] = this.iToCoord(i);\n    return this.coordToI([x, y+1]);\n  }\n\n  west(i) {\n    const [x, y] = this.iToCoord(i);\n    return this.coordToI([x-1, y]);\n  }\n\n  east(i) {\n    const [x, y] = this.iToCoord(i);\n    return this.coordToI([x+1, y]);\n  }\n\n  perform(action) {\n    let message = null;\n\n    action = action.toLowerCase();\n\n    const dir = this.grid.player.orientation;\n    const index = this.grid.player.index;\n    const facing = [\n      'north', 'east', 'south', 'west'\n    ][dir];\n    const inFront = this[facing](index);\n\n    const actions = {\n      r: () => {\n        this.grid.player.orientation = (dir + 1) % 4;\n        message = 'Turned right.';\n      },\n\n      l: () => {\n        this.grid.player.orientation = (dir === 0) ? 3 : (dir - 1);\n        message = 'Turned left.';\n      },\n\n      f: () => {\n        if (inFront < 0) {\n          throw {\n            type: 'dead',\n            reason: 'outside'\n          };\n        }\n\n        const oldLocation = this.grid.tiles[index];\n        const location = this.grid.tiles[inFront];\n        const tile = location.tile;\n        const feature = location.feature;\n\n        let canMove = false;\n\n        if (tile === TileTypes.Ground) {\n          // moving on ground\n          if (PassableTerrain.includes(feature)) {\n            canMove = true;\n          } else {\n            message = 'Blocked by: ' + Symbol.keyFor(feature);\n          }\n          if (feature === FeatureTypes.Start && this.inventory.includes(InventoryTypes.Gold)) {\n            message = true;\n            const inventoryAt = this.inventory.indexOf(InventoryTypes.Gold);\n            this.inventory.splice(inventoryAt, 1);\n          }\n          if (oldLocation.tile === TileTypes.Water && canMove) {\n            // moving from water to ground\n            message = 'Raft broke.';\n            const inventoryAt = this.inventory.indexOf(InventoryTypes.Raft);\n            this.inventory.splice(inventoryAt, 1);\n          }\n        } else if (tile === TileTypes.Wall) {\n          if (feature === FeatureTypes.DoorOpen) {\n            canMove = true;\n          } else if (feature === FeatureTypes.Wall) {\n            message = 'Walked into a wall.';\n          } else if (feature === FeatureTypes.Door) {\n            message = 'Door is locked.';\n          }\n          if (oldLocation.tile === TileTypes.Water && canMove) {\n            // moving from water to doorway\n            message = 'Raft broke.';\n            const inventoryAt = this.inventory.indexOf(InventoryTypes.Raft);\n            this.inventory.splice(inventoryAt, 1);\n          }\n        } else if (tile === TileTypes.Water) {\n          if (this.inventory.includes(InventoryTypes.Raft)) {\n            // if you have a raft you can move on water\n            canMove = true;\n          } else {\n            throw {\n              type: 'dead',\n              reason: 'drowned'\n            };\n          }\n        }\n\n        if (canMove) {\n          this.grid.player.index = inFront;\n\n          const pickups = [FeatureTypes.Key, FeatureTypes.Axe, FeatureTypes.Dynamite, FeatureTypes.Gold];\n\n          if (tile === TileTypes.Ground && pickups.includes(location.feature)) {\n            this.inventory.push(location.feature);\n            message = 'Picked up: ' + Symbol.keyFor(location.feature);\n            location.feature = FeatureTypes.Empty;\n          }\n\n          if (!message) {\n            message = 'Moved forward.';\n          }\n        }\n      },\n\n      c: () => {\n        const location = this.grid.tiles[inFront];\n        const feature = location.feature;\n\n        if (\n          this.inventory.includes(InventoryTypes.Axe) &&\n          inFront >= 0 &&\n          feature === FeatureTypes.Tree\n        ) {\n          // chop down the tree\n          location.feature = FeatureTypes.Stump;\n          if (this.inventory.includes(InventoryTypes.Raft)) {\n            message = 'Chopped down a tree. Already have a raft.';\n          } else {\n            this.inventory.push(InventoryTypes.Raft);\n            message = 'Chopped down a tree and made a raft.';\n          }\n        } else {\n          message = 'Unable to chop.';\n        }\n      },\n\n      u: () => {\n        const location = this.grid.tiles[inFront];\n        const feature = location.feature;\n\n        if (\n          this.inventory.includes(InventoryTypes.Key) &&\n          inFront >= 0 &&\n          feature === FeatureTypes.Door\n        ) {\n          // unlock the door\n          location.feature = FeatureTypes.DoorOpen;\n          message = 'Unlocked a door.';\n        } else {\n          message = 'Unable to unlock.';\n        }\n      },\n\n      b: () => {\n        const location = this.grid.tiles[inFront];\n\n        if (\n          this.inventory.includes(InventoryTypes.Dynamite) &&\n          inFront >= 0 &&\n          (\n            location.tile === TileTypes.Wall ||\n            location.feature === FeatureTypes.Tree\n          )\n        ) {\n          if (location.tile === TileTypes.Wall) {\n            message = 'Blasted wall.';\n          } else {\n            message = 'Blasted tree.';\n          }\n          location.tile = TileTypes.Ground;\n          location.feature = FeatureTypes.Exploded;\n          this.explosions.push(inFront);\n\n          // hack to make walls click together properly\n          const tileDirs = {\n            n: [this.north(inFront), 'linkS'],\n            s: [this.south(inFront), 'linkN'],\n            e: [this.east(inFront), 'linkW'],\n            w: [this.west(inFront), 'linkE']\n          };\n          Object.keys(tileDirs).forEach(key => {\n            const [index, link] = tileDirs[key];\n            const cell = this.grid.tiles[index];\n            if (index >= 0 && cell.tile === TileTypes.Wall) {\n              cell.orientation[link] = false;\n            }\n          });\n\n          const inventoryAt = this.inventory.indexOf(InventoryTypes.Dynamite);\n          this.inventory.splice(inventoryAt, 1);\n        } else {\n          if (!this.inventory.includes(InventoryTypes.Dynamite)) {\n            message = 'No dynamite.';\n          } else {\n            message = 'Nothing to blow up.';\n          }\n        }\n      }\n    };\n\n    const delegate = actions[action];\n\n    if (delegate) {\n      delegate();\n    } else {\n      message = 'Unknown instruction.';\n    }\n\n    return message;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./RuleSet.js\n\n\n// WEBPACK FOOTER //\n// ./RuleSet.js","// Base background tile types\nexport const TileTypes = {\n  Water: Symbol.for('Water'),\n  Ground: Symbol.for('Ground'),\n  Wall: Symbol.for('Wall')\n};\n\n// Features which may be on tiles\nexport const FeatureTypes = {\n  Empty: Symbol.for('Empty'),\n  Tree: Symbol.for('Tree'),\n  Stump: Symbol.for('Stump'), // extra, shimmed in (for aesthetics)\n  Start: Symbol.for('Start'), // extra, shimmed in (for aesthetics)\n  Wall: Symbol.for('Wall'),\n  Door: Symbol.for('Door'),\n  DoorOpen: Symbol.for('DoorOpen'), // extra, shimmed in (for aesthetics)\n  Stone: Symbol.for('Stone'),\n  Axe: Symbol.for('Axe'),\n  Key: Symbol.for('Key'),\n  Gold: Symbol.for('Gold'),\n  Dynamite: Symbol.for('Dynamite'),\n  Exploded: Symbol.for('Exploded'),\n  Wilson: Symbol.for('Wilson')\n};\n\nexport const PlayerChars = ['^', '>', 'v', '<'];\n\nexport const PlayerDirections = {\n  North: 0,\n  East: 1,\n  South: 2,\n  West: 3\n};\n\nexport const InventoryTypes = {\n  Stone: Symbol.for('Stone'),\n  Axe: Symbol.for('Axe'),\n  Key: Symbol.for('Key'),\n  Gold: Symbol.for('Gold'),\n  Raft: Symbol.for('Raft'),\n  Dynamite: Symbol.for('Dynamite')\n};\n\n\n\n// WEBPACK FOOTER //\n// ./Constants.js\n\n\n// WEBPACK FOOTER //\n// ./Constants.js"],"sourceRoot":""}